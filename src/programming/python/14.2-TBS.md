---
title: 14.2 å›åˆåˆ¶æ‰“æ€ªæ¸¸æˆè®¾è®¡ï¼ˆæ–‡å­—ç‰ˆï¼‰
icon: boke
date: 2025-11-17 13:50:10
author: Ran
isOriginal: true
sticky: false
star: false
article: true
timeline: true
image: false
navbar: true
sidebarIcon: true
comment: true
lastUpdated: true
editLink: true
backToTop: true
toc: true
---

## 9. ç»ƒä¹ 

![](./14.2-TBS.assets/image-20250821144554990.png)

![](./14.2-TBS.assets/image-20250821144627264.png)

### 9.1 ä¸ªäººå›ç­”

```python
import random

class Game():
    # åˆå§‹åŒ–ç©å®¶å§“åã€HPã€æ•ŒäººHP
    def __init__(self, player_name):
        self.player_name = player_name
        self.player_hp = 100
        self.enemy_hp = 80


    # ç©å®¶æ“ä½œæ”»å‡»/é˜²å®ˆ
    def actions(self):
        self.action = input('Attack or Defense (A/D):')
        if self.action == 'A':
            self.enemy_hp -= random.randint(1, 20)
            if self.enemy_hp <=0:
                return
            self.player_hp -= random.randint(1, 20)
        elif self.action == 'D':
            self.player_hp -= random.randint(1, 20)/10
        else:
            print('Invalid action')

#  main
player_name = input('è¯·è¾“å…¥ç©å®¶å§“åï¼š')
player1 = Game(player_name)             # åˆ›å»ºå®ä¾‹å¹¶å®Œæˆåˆå§‹åŒ–


while player1.player_hp > 0 and player1.enemy_hp >0:
    # æ˜¾ç¤ºç©å®¶å’Œæ•Œäººè¡€é‡
    print(f'{player1.player_name} HP: {player1.player_hp:.2f}')
    print(f'Enemy HP: {player1.enemy_hp:.2f}')

    # è°ƒç”¨æ“ä½œå‡½æ•°ï¼Œç©å®¶é€‰æ‹©æ”»å‡»/é˜²å®ˆ
    player1.actions()

if player1.player_hp > 0:
    print('You win!')
else:
    print('You lose!')


# ---output---
è¯·è¾“å…¥ç©å®¶å§“åï¼šRan
Ran HP: 100.00
Enemy HP: 80.00
Attack or Defense (A/D):A
Ran HP: 91.00
Enemy HP: 61.00
Attack or Defense (A/D):A
Ran HP: 79.00
Enemy HP: 48.00
Attack or Defense (A/D):A
Ran HP: 70.00
Enemy HP: 30.00
Attack or Defense (A/D):D
Ran HP: 68.80
Enemy HP: 30.00
Attack or Defense (A/D):D
Ran HP: 68.10
Enemy HP: 30.00
Attack or Defense (A/D):D
Ran HP: 67.60
Enemy HP: 30.00
Attack or Defense (A/D):A
Ran HP: 47.60
Enemy HP: 27.00
Attack or Defense (A/D):A
Ran HP: 40.60
Enemy HP: 26.00
Attack or Defense (A/D):A
Ran HP: 25.60
Enemy HP: 23.00
Attack or Defense (A/D):A
Ran HP: 7.60
Enemy HP: 8.00
Attack or Defense (A/D):D
Ran HP: 7.00
Enemy HP: 8.00
Attack or Defense (A/D):D
Ran HP: 6.60
Enemy HP: 8.00
Attack or Defense (A/D):A
You win!
```



### 9.2 è€å¸ˆæ€è·¯

ä¼˜åŒ–ï¼š

- ç©å®¶å’Œæ•Œäººéƒ½å¯ä»¥å½“åšæ˜¯å¯¹è±¡ï¼Œå› æ­¤åˆå§‹åŒ–æ—¶å¯ä»¥æŠŠæ•Œäººä¹Ÿå½“åšæ˜¯ç±»ä¼¼å¯¹è±¡çš„å®ä¾‹ã€‚

```python
import random

class Creature():
    def attack(self):
        attack_value = random.randint(1, 50)
        return attack_value
    
player = Creature()
enemy = Creature()
```

æ­¤å¤„éœ€è¦è€ƒè™‘ç±»ç©¶ç«Ÿå¦‚ä½•ä½¿ç”¨ï¼Œç©å®¶å’Œæ•Œäººéƒ½æ˜¯ç±»ä¼¼çš„å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç±»å°†å…¶å®ä¾‹åŒ–å‡ºæ¥ã€‚

- æ¸¸æˆç»§ç»­çš„æ¡ä»¶æ˜¯ç©å®¶å’Œæ•Œäººéƒ½è¿˜æ´»ç€ï¼Œå› æ­¤å¯ä»¥å»ºç«‹ä¸€ä¸ª `while` å‡½æ•°ï¼Œæ¡ä»¶å°±æ˜¯ `player.not_dead() and enemy.not_dead()` ï¼Œæ­¤å¤„åˆå­˜åœ¨å…±æ€§ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç±»ä¸­å»ºç«‹ä¸€ä¸ªå‡½æ•°çœ‹ç©å®¶å’Œæ•Œäººæ˜¯å¦éƒ½å­˜æ´»ã€‚

```python
import random

class Creature():
    def attack(self):
        attack_value = random.randint(1, 50)
        return attack_value
    
    def not_dead(self):
        pass

player = Creature()
enemy = Creature()

while player.not_dead() and enemy.not_dead():
    pass
```



- å½“éœ€è¦ç¼–å†™ `not-dead` å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å‘ç°åˆ¤æ–­æ˜¯å¦æ­»äº¡çš„æ ‡å‡†æ˜¯è¡€é‡ï¼Œä½†æ˜¯ç›®å‰è¿˜æ²¡æœ‰è¡€é‡è¿™ä¸ªå‚æ•°ï¼Œå› æ­¤ï¼Œå¯ä»¥åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†è¡€é‡å½“åšå‚æ•°ä¼ è¿›å»ï¼Œå°±éœ€è¦äº† `init` å‡½æ•°ï¼Œæ­¤æ—¶å†ç¼–å†™ `init` å‡½æ•°ï¼Œå¹¶åŠ å…¥éœ€è¦çš„å‚æ•°ã€‚

```python
import random

class Creature():
    def __init__(self, hp):                    # æ ¹æ®éœ€è¦è®¾ç½®å‚æ•°ï¼Œåˆå§‹åŒ–
        self.hp = hp
        
        
    def attack(self):
        attack_value = random.randint(1, 50)
        return attack_value

    def not_dead(self):
        pass

player = Creature(100)                          # ä¼ å…¥å‚æ•°
enemy = Creature(80)

while player.not_dead() and enemy.not_dead():
    pass
```



- æœ‰äº† hp å°±å¯ä»¥ç¼–å†™ not_dead è¿™ä¸ªå‡½æ•°äº†ï¼Œå³è¡€é‡ï¼0 ä¸º Trueã€‚

```python
    def not_dead(self):
        if self.hp > 0:
            return True
        else:
            return False
```

ç»§ç»­ä¼˜åŒ–ï¼š

ä¸Šè¿°ä»£ç æ˜¯ä¸ºäº†å½“ç¬¦åˆæŸç§æ¡ä»¶æ—¶ï¼Œè¿”å›æˆ‘ä»¬æŒ‡å®šçš„ç»“æœï¼Œä»æ¯”è¾ƒè¿ç®—ç¬¦å¤„å¯çŸ¥ï¼Œè¿è¡Œçš„ç»“æœæ˜¯**å¸ƒå°”ç±»å‹** ï¼Œæ°å¥½å’Œæˆ‘ä»¬æœ¬èº«å¸Œæœ›è¿”å›çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤å¯ä»¥ä¼˜åŒ–æˆç›´æ¥è¿”å›æ¯”è¾ƒçš„ç»“æœï¼Œå³ `return self.hp > 0`  ã€‚

```python
    def not_dead(self):
        if self.hp <= 0:
            return False
        else:
            return True
        
        # ç­‰ä»· 1
        # if self.hp <= 0:
        #     return False
        # return True

        # ç­‰ä»· 2
        # æœ¬èº«ä¸Šè¿°çš„å†™æ³•ï¼Œæ˜¯ä¸ºäº†å½“ç¬¦åˆæŸç§æ¡ä»¶æ—¶ï¼Œè¿”å›æˆ‘ä»¬æŒ‡å®šçš„ç»“æœ
        # è€Œæˆ‘ä»¬ç°åœ¨éœ€è¦è¿”å›çš„ç»“æœï¼Œæ°å¥½å’Œæˆ‘ä»¬æœ¬èº«æŒ‡å®šçš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤å¯ä»¥ä¼˜åŒ–æˆå¦‚ä¸‹ä»£ç ï¼š
        # return self.hp > 0
```





- ç–‘é—®ç‚¹ï¼šæ˜¯å¦éœ€è¦å†™ defenceï¼Ÿæ„Ÿè§‰é€»è¾‘å¤æ‚ä¸é€šã€‚

è‡ªå·±ç»§ç»­ä¸Šè¿°æ€è·¯è¡¥å……çš„åç»­ä»£ç å¦‚ä¸‹ï¼š

```python
import random

class Game():
    # åˆå§‹åŒ–ç©å®¶å§“åã€HPã€æ•ŒäººHP
    def __init__(self, player_name):
        self.player_name = player_name
        self.player_hp = 100
        self.enemy_hp = 80


    # ç©å®¶æ“ä½œæ”»å‡»/é˜²å®ˆ
    def actions(self):
        self.action = input('Attack or Defense (A/D):')
        if self.action == 'A':
            self.enemy_hp -= random.randint(1, 20)
            if self.enemy_hp <=0:
                return
            self.player_hp -= random.randint(1, 20)
        elif self.action == 'D':
            self.player_hp -= random.randint(1, 20)/10
        else:
            print('Invalid action')

#  main
player_name = input('è¯·è¾“å…¥ç©å®¶å§“åï¼š')
player1 = Game(player_name)             # åˆ›å»ºå®ä¾‹å¹¶å®Œæˆåˆå§‹åŒ–


while player1.player_hp > 0 and player1.enemy_hp >0:
    # æ˜¾ç¤ºç©å®¶å’Œæ•Œäººè¡€é‡
    print(f'{player1.player_name} HP: {player1.player_hp:.2f}')
    print(f'Enemy HP: {player1.enemy_hp:.2f}')

    # è°ƒç”¨æ“ä½œå‡½æ•°ï¼Œç©å®¶é€‰æ‹©æ”»å‡»/é˜²å®ˆ
    player1.actions()

if player1.player_hp > 0:
    print('You win!')
else:
    print('You lose!')
```

ä»¥ä¸Šä»£ç æš‚æ—¶ä¿ç•™ï¼Œç»§ç»­è€å¸ˆæ€è·¯ï¼š

- æœ‰hp å€¼ï¼Œä¸‹ä¸€æ­¥å¯ä»¥ç»§ç»­å®ç°äº¤äº’

```python
 if user_input == 'A':
        player_attack_value = player.attack()
        enemy_attack_value = enemy.attack()
```

ä¸Šè¿°ä»£ç æœ‰äº†ï¼Œæˆ‘ä»¬æƒ³åˆ°ï¼Œæ— è®ºæ•Œäººæˆ–ç©å®¶ï¼Œéƒ½æœ‰æ”¶åˆ°æ”»å‡»çš„æƒ…èŠ‚ï¼Œå› æ­¤å¯ä»¥ç»§ç»­å†™ä¸€ä¸ªå‡½ èƒ½å¤Ÿå®ç°`player.being_attack(enemy_attack_value)` ã€‚

```python
   def being_attack(self, attack_value):
        self.hp -= attack_value
```

å› æ­¤ï¼Œä¸»ç¨‹åºå¤„è¿›è¡Œæ”»å‡»å’Œé˜²å®ˆå°±å¯å†™æˆï¼š

```python
    if user_input == 'A':
        player_attack_value = player.attack()
        enemy_attack_value = enemy.attack()

        enemy.being_attack(player_attack_value)
        player.being_attack(enemy_attack_value)

    elif user_input == 'D':
        enemy_attack_value = enemy.attack()
        player.being_attack(enemy_attack_value * 0.1)      # å› ä¸ºä¸åŒè½¯ä»¶å¯¹é™¤æ³•çš„å¤„ç†ç•¥æœ‰ä¸åŒï¼Œæ›´å€¾å‘ä½¿ç”¨ä¹˜æ³•è€Œä¸æ˜¯é™¤æ³•
```



- è¿è¡Œä»£ç åï¼Œå‘ç°æ²¡æœ‰è¡€é‡ã€ä¸çŸ¥é“æ¸¸æˆè¿›ç¨‹ã€ä¸çŸ¥é“æ¸¸æˆä½•æ—¶ç»“æŸã€‚é¦–å…ˆè¡¥å……è¡€é‡æ˜¾ç¤ºï¼š

æ˜¾ç¤ºè¡€é‡åœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼ŸA or B or C or D

```python
player = Creature(100)
enemy = Creature(80)
# A
while player.not_dead() and enemy.not_dead():
    # B
    user_input = input("Attack or Defence (A/D): ")  # æ“ä½œ
    # C
    if user_input == 'A':
        player_attack_value = player.attack()
        enemy_attack_value = enemy.attack()

        enemy.being_attack(player_attack_value)
        player.being_attack(enemy_attack_value)
    elif user_input == 'D':
        enemy_attack_value = enemy.attack()
        player.being_attack(enemy_attack_value * 0.1)
    # D
```

---



é€‰æ‹©æ˜¾ç¤ºè¡€é‡çš„ä»£ç ä½ç½®æ—¶ï¼Œé¦–å…ˆéœ€è¦åˆ¤æ–­åœ¨å¾ªç¯å†…å¤–ï¼Œç”±äºè¡€é‡éœ€è¦å®æ—¶æ›´æ–°ï¼Œå› æ­¤éœ€è¦åœ¨å¾ªç¯å†…ã€‚

å…¶æ¬¡ï¼Œåœ¨æ“ä½œå‰è¦æ ¹æ®è¡€é‡åˆ¤æ–­æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œå› æ­¤æ”¾åœ¨ `user_input` ä¹‹å‰ã€‚

```python
while player.not_dead() and enemy.not_dead():
    # æ­¤å¤„æ·»åŠ è¡€é‡æ˜¾ç¤º
    print()
    user_input = input('Attack or Defence (A/D): ')          # æ“ä½œ
    if user_input == 'A':
        player_attack_value = player.attack()
        enemy_attack_value = enemy.attack()

        enemy.being_attack(player_attack_value)
        player.being_attack(enemy_attack_value)

    elif user_input == 'D':
        enemy_attack_value = enemy.attack()
        player.being_attack(enemy_attack_value * 0.1)      # å› ä¸ºä¸åŒè½¯ä»¶å¯¹é™¤æ³•çš„å¤„ç†ç•¥æœ‰ä¸åŒï¼Œæ›´å€¾å‘ä½¿ç”¨ä¹˜æ³•è€Œä¸æ˜¯é™¤æ³•
```



- å¯ä»¥æŠŠæ˜¾ç¤ºè¡€é‡å†™æˆä¸€ä¸ªå‡½æ•°

```python
    def show_status(self):
        print(f'HP: {self.hp}')
```

ä¸»ç¨‹åºè°ƒç”¨

```python
while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()
    user_input = input('Attack or Defence (A/D): ')          # æ“ä½œ
```

- æ˜¾ç¤ºè¡€é‡çš„æ—¶å€™å‘ç°ä¸çŸ¥é“å“ªä¸ªæ˜¯å“ªä¸ªçš„è¡€é‡ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

éœ€è¦åå­—è¿™ä¸ªå˜é‡ï¼Œé‚£å°±åˆå§‹åŒ–çš„æ—¶å€™ä¼ è¿›å»ï¼š

```python
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp
        
    def show_status(self):
        print(f"{self.name}'s HP: {self.hp}")
    
```

```python
player = Creature('Ran',100)
enemy = Creature('Monster',80)
```

- æ·»åŠ åˆ¤æ–­æ¸¸æˆç»“æœçš„ä»£ç ï¼Œæ”¾åœ¨å¾ªç¯ç»“æŸåï¼š

```python
if player.hp > 0:
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose!")
```



ç–‘é—®ï¼šä»€ä¹ˆæ—¶å€™é€‰æ‹©å†™æˆå‡½æ•°ï¼Ÿ

1. éœ€è¦é‡å¤ä½¿ç”¨ï¼Œå­˜åœ¨å…±æ€§çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ç©å®¶æœ‰å¤šä¸ªï¼Œä¸éœ€è¦å†™å¤šä¸ª `print` æ¥æ˜¾ç¤ºè¡€é‡ã€‚
2. æœ‰å°è£…éœ€æ±‚ï¼Œæ–¹ä¾¿åæœŸç»Ÿä¸€ä¿®æ”¹ç»´æŠ¤ã€‚
3. è‹¥å†™åœ¨ä¸»ç¨‹åºé‡Œï¼Œä¿®æ”¹æ—¶å¯èƒ½éœ€è¦æ‹å‰åä»£ç é€»è¾‘ï¼Œè¾“å‡ºå¯èƒ½å˜åŠ¨ï¼Œè‹¥å°è£…æˆå‡½æ•°ï¼Œåªè¦ä¿è¯ return ä¸å˜ï¼Œä¸»å‡½æ•°çš„ä»£ç å‡ºé”™çš„æ¦‚ç‡å°†ä¼šå¤§å¤§å‡å°‘ã€‚

---

### 9.3 å¯¹è‡ªå·±çš„ä»£ç è¿›è¡Œä¿®æ”¹

å¯¹è‡ªå·±å†™çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼š

- ç©å®¶å§“åå¯ä»¥å½“åšå‚æ•°ä¼ å…¥ç±»ä¸­ï¼Œåœ¨åˆå§‹åŒ–æ­¥éª¤ä¸­å®Œæˆï¼Œä¹Ÿå¯å¯¹æ•Œäººèµ·åã€‚

```python
class Creature():
    # åˆå§‹åŒ–å§“åã€HP
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp
```

å› æ­¤ï¼Œåç»­ç¨‹åºä¸­ï¼Œå¯ä»¥æ·»åŠ  `Creature(player_name, 100)` å’Œ `Creature(Enemy, 80)` åˆ›å»ºç©å®¶å’Œæ•Œäººã€‚

```python
player_name = input('è¯·è¾“å…¥ç©å®¶å§“åï¼š')
player = Creature(player_name, 100)             # åˆ›å»ºç©å®¶å¹¶å®Œæˆåˆå§‹åŒ–
enemy = Creature('Monster', 80)          # åˆ›å»ºæ•Œäººå¹¶åˆå§‹åŒ–
```

ä¸ªäººä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š

```python
import random


# å°†ç©å®¶å’Œæ•Œäººéƒ½æŠ½è±¡æˆä¸€ä¸ªç±»
class Creature():
    def __init__(self, name, hp):                          # ä¸ç©å®¶å’Œæ•Œäººéƒ½ç›¸å…³çš„åŸºæœ¬å‚æ•°æ˜¯å§“åå’Œè¡€é‡
        self.name = name
        self.hp = hp

    def show_HP(self):                                     # æ˜¾ç¤ºè¡€é‡
        print(f"{self.name}'s HP: {self.hp}")

    def is_alive(self):                                    # ä¸ä¸¤è€…éƒ½ç›¸å…³çš„å­˜äº¡çŠ¶æ€
        return self.hp > 0

    def defence(self, harm):                               # è‡ªå·±é˜²å®ˆæ—¶ï¼Œè¡€é‡åªå‡ååˆ†ä¹‹ä¸€
        self.hp -= 0.1*harm

    def being_attack(self, harm, action):                  # è¢«æ”»å‡»ï¼Œè‡ªå·±è¡€é‡å˜åŒ–
        if action == "D":
            self.defence(harm)
        else:
            self.hp -= harm

    def attack(self, target, action='A'):                   # æ”»å‡»å¯¹æ–¹ï¼Œä¸ºäº†åŒºåˆ†ç©å®¶å’Œæ•Œäººï¼Œéœ€è¦æœ‰ä¸€ä¸ªæ”»å‡»å¯¹è±¡
        harm = random.randint(0, 50)
        target.being_attack(harm, action)                   # å¯¹æ–¹è¢«æ”»å‡»äº†ï¼Œå¯¹æ–¹è¡€é‡å˜åŠ¨ï¼Œåªæœ‰è¢«æ”»å‡»å’Œæ”»å‡»åˆ†å¼€ä¸¤ä¸ªå‡½æ•°ï¼Œæ‰èƒ½å®ç°å¯¹æ–¹è¡€é‡å˜åŠ¨


# æ¸¸æˆäº¤äº’é˜¶æ®µå¼€å§‹
class Game():
    def __init__(self, player_name):                            # ç©å®¶ç»™å‡ºçš„å§“åä½œä¸ºå‚æ•°ä¼ è¿›å»
        self.player = Creature(player_name, 100)
        self.enemy = Creature('Monster', 80)          # åˆå§‹åŒ–å‡ºæ•Œäºº

    def actions(self):
        while True:
            action = input('Attack or Defence (A/D): ')
            if action in ('A', 'D'):
                return action
            else:
                print("è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ã€‚")

    def play(self):
        while self.player.is_alive() and self.enemy.is_alive():
            self.player.show_HP()
            self.enemy.show_HP()

            # ç©å®¶å¼€å§‹é€‰æ‹©æ”»å‡»/é˜²å®ˆ
            player_action = self.actions()
            if player_action == 'A':
                self.player.attack(self.enemy)         # ç©å®¶æ”»å‡»æ•Œäººå‡è¡€ï¼Œç©å®¶é˜²å®ˆæ—¶ï¼Œæ•Œäººä¸å‡è¡€ï¼Œå› æ­¤ä¸éœ€è¦æ“ä½œ

            # æ•Œæ–¹å¼€å§‹åå‡»
            if self.enemy.is_alive():                  # çœ‹çœ‹æ•Œæ–¹è¿˜æœ‰è¡€æ²¡ï¼Œæœ‰è¡€å†æ‰“
                self.enemy.attack(self.player, player_action)

        # ç»“ç®—ç»“æœ
        if self.player.is_alive():
            print("\nğŸ‰ ä½ èµ¢äº†ï¼")
        else:
            print("\nğŸ’€ ä½ è¾“äº†ï¼")

# main
player_name = input("è¯·è¾“å…¥ç©å®¶å§“åï¼š")
game = Game(player_name)
game.play()

```

ä¼˜åŒ–ï¼š

- å‡½æ•°å‘½åå°½é‡ä¸è¦ç”¨å¤§å†™ï¼Œä¿®æ”¹å¦‚ä¸‹

```python
def show_hp(self):                                     # æ˜¾ç¤ºè¡€é‡
        print(f"{self.name}'s HP: {self.hp}")
```

- å‡½æ•°çš„æ³¨é‡Šå¯ä»¥ç›´æ¥åœ¨å‡½æ•°å†…ç¬¬ä¸€è¡ŒåŠ ä¸‰ä¸ªåŒå¼•å·ï¼Œå¦‚ä¸‹ï¼š

```python
    def being_attack(self, harm, action):
        """
        è¢«æ”»å‡»æ—¶çš„è¡€é‡å˜åŒ–
        :param harm: ä¼¤å®³å€¼
        :param action: "A" è¡¨ç¤ºæ”»å‡»ï¼›"D" è¡¨ç¤ºé˜²å®ˆ
        """
        if action == "D":
            self.defence(harm)
        else:
            self.hp -= harm
```

å…¶ä¸­ï¼Œ`:param` æ˜¯å½¢å‚ï¼Œå¯ä»¥å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ³¨é‡Šã€‚





### 9.4 åŠŸèƒ½æ‰©å±•

#### 9.4.1 ä¼˜åŒ–è¡€é‡çš„æ˜¾ç¤ºæ•ˆæœ

```python
    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp}")
```

#### 9.4.2 è¡€é‡é—®é¢˜ï¼šä¼šå‡ºç°è´Ÿæ•°çš„æƒ…å†µ

å¦‚ä½•éªŒè¯è¡€é‡è´Ÿæ•°æƒ…å†µï¼Ÿ

ä¸¤ä¸ªæ–¹å‘ï¼šæ‰©å¤§å‡è¡€çš„èŒƒå›´ï¼Œå°†0.1æ”¹æ‰ï¼›åœ¨è¾“æ‰çš„æ—¶å€™æ˜¾ç¤ºè¡€é‡ã€‚

```python
You lose! Your HP: -1.800000000000023
```

åŒç†ï¼Œä¹Ÿå¯ä»¥åœ¨ç»“æœå‡ºè¾“å‡ºæ•Œäººè¡€é‡ï¼š

```python
You win! Enemy HP: -1
```

æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ `while` çš„æ¡ä»¶ï¼Œåªä¿ç•™ç©å®¶ä¸æ­»çš„æ¡ä»¶ï¼Œç©å®¶ä¸€ç›´æ”»å‡»ï¼Œæ•Œäººå¾ˆå¿«è¡€é‡å˜å¤æ•°ï¼Œä½†æ˜¯æ­¤æ—¶å¾ªç¯è¿˜æœªç»“æŸï¼Œæ˜¾ç¤ºè¡€é‡ `show_status()` é˜¶æ®µï¼Œä¼šå‡ºç°è´Ÿæ•°çš„æ•Œäººè¡€é‡ã€‚

```python
Ran's HP â†’ 100
Monster's HP â†’ 80
Attack or Defence (A/D): A
Ran's HP â†’ 70
Monster's HP â†’ 36
Attack or Defence (A/D): A
Ran's HP â†’ 64
Monster's HP â†’ -6
Attack or Defence (A/D): A
Ran's HP â†’ 36
Monster's HP â†’ -32
```

å¦‚ä½•ä¿®æ”¹è¡€é‡æ˜¯è´Ÿæ•°çš„æƒ…å†µï¼Ÿ

æ€è·¯ï¼šä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°è´Ÿæ•°ï¼Ÿå‡è¡€é‡çš„æ—¶å€™ã€‚

æ–¹æ³•ä¸€ï¼šåˆ¤æ–­ä¼¤å®³å€¼å’Œå‰©ä½™è¡€é‡ï¼Œä¼¤å®³å€¼é«˜ï¼Œè¡€é‡å½’é›¶ï¼Œä¼¤å®³å€¼ä½ï¼Œæ­£å¸¸å‡ï¼š

```python
    def being_attack(self, attack_value):
        if attack_value >= self.hp:
            self.hp = 0
        else:
            self.hp -= attack_value
```

æ–¹æ³•äºŒï¼šå…ˆè¿›è¡Œå‡è¡€ï¼Œè‹¥å‡å‡ºè´Ÿæ•°ï¼Œåˆ™è¿›è¡Œå½’é›¶å¤„ç†ï¼š

```python
    def being_attack(self, attack_value):
        self.hp -= attack_value
        if self.hp <= 0:
            self.hp = 0
```

æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ `max()` å‡½æ•°

`int(self.hp-attack_value)` æ­¤å¤„å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯æ­£æ•°ï¼Œä½†æ˜¯ `max()` åšåˆ°äº†ä»ä¸¤ä¸ªå…ƒç´ ä¸­å–æœ€å¤§å€¼ï¼Œå› æ­¤è¯¥å€¼æ˜¯è´Ÿæ•°çš„æ—¶å€™ï¼Œæ€»ä¼šå–åˆ°æœ€å¤§å€¼ `0` ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å®ç°è¡€é‡çš„æ§åˆ¶ã€‚

```python
    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))
```





#### 9.4.3 ç”¨æˆ·è¾“å…¥æ§åˆ¶

è¦å¯¹ç”¨æˆ·è¾“å…¥å¯èƒ½å‡ºç°çš„ç©ºæ ¼å’Œå°å†™æ§åˆ¶ï¼Œå¹¶ä¸”å½“è¾“å…¥é”™è¯¯æ—¶ï¼Œå¯ä»¥å®ç°é‡æ–°è¾“å…¥ï¼š

```python
user_input = input('Attack or Defence (A/D): ').strip().upper()
    while user_input not in ('A', 'D'):
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ A æˆ– D').strip().upper()
```



#### 9.4.4 æ•ŒäººçŠ¶æ€éšæ„

æ•Œäººæ˜¯éšæœºçŠ¶æ€ï¼Œæœ‰å¯èƒ½æ˜¯æ”»å‡»ï¼Œæœ‰å¯èƒ½æ˜¯é˜²å®ˆã€‚å¦‚æœæ•Œäººæ˜¯é˜²å®ˆçŠ¶æ€ï¼Œå—åˆ°ç©å®¶ä¼¤å®³å‡åŠã€‚

1. åˆæ­¥å®ç°

```python
enemy_status = random.choice(['A', 'D'])
        if enemy_status == 'D':
            enemy.being_attack(0.5 * player_attack_value)
```

2. åœ¨ç©å®¶çš„æ“ä½œä¸­å®ç°

ç©å®¶æ”»å‡»æ—¶å®ç°å¦‚ä¸‹ï¼š

```python
    if user_input == 'A':
        enemy_status = random.choice(['A', 'D'])
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_value = 0.5*player.attack()
        else:
            print(f'{enemy.name} chose to attack!')
            player_attack_value = player.attack()
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)
            
        enemy.being_attack(player_attack_value)    
```

å½“ç©å®¶é˜²å®ˆæ—¶ï¼Œåº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ

```python
import random

class Creature():
    # ---snip---

player = Creature('Ran',100)
enemy = Creature('Monster',80)

while player.not_dead() and enemy.not_dead():
    # ---snip---

    if user_input == 'A':
        # ---snip---

    elif user_input == 'D':
        enemy_status = random.choice(['A', 'D'])
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            print('Both defended, no damage dealt.')
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)

# ---snip---
```

ç›®å‰å®Œæ•´ä»£ç ï¼š

```python
import random

class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp

    def attack(self):
        attack_value = random.randint(0, 50)
        return attack_value

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))

    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp}")



player = Creature('Ran',100)
enemy = Creature('Monster',80)

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    user_input = input('Attack or Defence (A/D): ').strip().upper()
    while user_input not in ('A', 'D'):
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ A æˆ– D').strip().upper()



    if user_input == 'A':
        enemy_status = random.choice(['A', 'D'])
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_value = 0.5*player.attack()
        else:
            print(f'{enemy.name} chose to attack!')
            player_attack_value = player.attack()
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)

        enemy.being_attack(player_attack_value)

    elif user_input == 'D':
        enemy_status = random.choice(['A', 'D'])
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            print('Both defended, no damage dealt.')
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)


if player.hp > 0:
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose! ")
```



#### 9.4.5 æ”¹è‰¯å®ç°

- å¯ä¼˜åŒ–ç‚¹ä¸€ï¼šç©å®¶è¿›è¡Œæ”»å‡»æ“ä½œæ—¶ï¼Œæ— è®ºæ•Œäººä»€ä¹ˆçŠ¶æ€ï¼ˆæ”»å‡»oré˜²å®ˆï¼‰ï¼Œç©å®¶éƒ½è¦æ”»å‡»ï¼Œæ•Œäººä¸€å®šä¼šå‡è¡€ã€‚

    ::: code-tabs

    @tab ä¼˜åŒ–å‰

    ```python
        if user_input == 'A':
            enemy_status = random.choice(['A', 'D'])
            if enemy_status == 'D':
                print(f'{enemy.name} chose to defend!')
                player_attack_value = 0.5*player.attack()
            else:
                print(f'{enemy.name} chose to attack!')
                player_attack_value = player.attack()
                enemy_attack_value = enemy.attack()
                player.being_attack(enemy_attack_value)
    
            enemy.being_attack(player_attack_value)
    ```

    @tab ä¼˜åŒ–å

    ```python
        if user_input == 'A':
            enemy_status = random.choice(['A', 'D'])
            player_attack_coefficient = 1
            if enemy_status == 'D':
                print(f'{enemy.name} chose to defend!')
                player_attack_coefficient = 0.5
            else:
                print(f'{enemy.name} chose to attack!')
                enemy_attack_value = enemy.attack()
                player.being_attack(enemy_attack_value)
                
            player_attack_value = player.attack()
            enemy.being_attack(player_attack_value * player_attack_coefficient)
    ```

    

    :::

    


- å¯ä¼˜åŒ–ç‚¹äºŒï¼šç©å®¶é€‰æ‹©æ”»å‡»åè¦åˆ¤æ–­æ•ŒäººçŠ¶æ€ï¼Œç©å®¶é€‰æ‹©é˜²å®ˆæ—¶ä¹ŸåŒæ ·è¦åˆ¤æ–­æ•ŒäººçŠ¶æ€ï¼Œéƒ½éœ€è¦ç”Ÿæˆä¸€ä¸ªè¡¨ç¤ºæ•ŒäººçŠ¶æ€çš„å˜é‡ã€‚

    ::: code-tabs

    @tab ä¼˜åŒ–å‰

    ```python
        if user_input == 'A':
            enemy_status = random.choice(['A', 'D'])
            player_attack_coefficient = 1
            if enemy_status == 'D':
                print(f'{enemy.name} chose to defend!')
                player_attack_coefficient = 0.5
            else:
                print(f'{enemy.name} chose to attack!')
                enemy_attack_value = enemy.attack()
                player.being_attack(enemy_attack_value)
    
            player_attack_value = player.attack()
            enemy.being_attack(player_attack_value * player_attack_coefficient)
    
    
        elif user_input == 'D':
            enemy_status = random.choice(['A', 'D'])
            if enemy_status == 'D':
                print(f'{enemy.name} chose to defend!')
                print('Both defended, no damage dealt.')
            else:
                print(f'{enemy.name} chose to attack!')
                enemy_attack_value = 0.1*enemy.attack()
                player.being_attack(enemy_attack_value)
    ```

    @tab ä¼˜åŒ–å

    ```python
    # å°†æ¶‰åŠæ•ŒäººçŠ¶æ€çš„ä»£ç æå‡ºæ¥
        enemy_status = random.choice(['A', 'D'])
        if user_input == 'A':
            player_attack_coefficient = 1
            if enemy_status == 'D':
                print(f'{enemy.name} chose to defend!')
                player_attack_coefficient = 0.5
            else:
                print(f'{enemy.name} chose to attack!')
                enemy_attack_value = enemy.attack()
                player.being_attack(enemy_attack_value)
    
            player_attack_value = player.attack()
            enemy.being_attack(player_attack_value * player_attack_coefficient)
    
    
        elif user_input == 'D':
            if enemy_status == 'D':
                print(f'{enemy.name} chose to defend!')
                print('Both defended, no damage dealt.')
            else:
                print(f'{enemy.name} chose to attack!')
                enemy_attack_value = 0.1*enemy.attack()
                player.being_attack(enemy_attack_value)
    ```

    

    :::



å½“æˆ‘ä»¬ä¼˜åŒ–åï¼Œå‘ç°ç¬¬ä¸€ä¸ªä¼˜åŒ–å…¶å®æ„ä¹‰ä¸å¤§ï¼Œä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­å°±æ˜¯å¦‚æ­¤ï¼Œä½ æ›´æ–°äº†ä¸€ä¸ªæ–°çš„åŠŸèƒ½æˆ–ä»£ç ï¼Œå®¢æˆ·ã€ç”¨æˆ·è§‰å¾—æ²¡å¿…è¦ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ‡’å¾—æ”¹å›å»ã€‚

ç›®å‰å®Œæ•´ä»£ç ï¼š

```python
import random

class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp

    def attack(self):
        attack_value = random.randint(0, 50)
        return attack_value

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))

    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp}")



player = Creature('Ran',100)
enemy = Creature('Monster',80)

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    user_input = input('Attack or Defence (A/D): ').strip().upper()
    while user_input not in ('A', 'D'):
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ A æˆ– D').strip().upper()

    enemy_status = random.choice(['A', 'D'])
    if user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            print('Both defended, no damage dealt.')
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)


if player.hp > 0:
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose! ")
```

#### 9.4.6 æ¸¸æˆç­–ç•¥å‡çº§

å½“å‰æ¸¸æˆç­–ç•¥å¹¶ä¸å®Œå¤‡ã€‚

å› ä¸ºç©å®¶é˜²å®ˆæ—¶ï¼Œæ•Œäººå¿…é¡»è¦æ”»å‡»ï¼Œä¸èƒ½ä¸¤ä¸ªäººéƒ½é˜²å®ˆã€‚

å› æ­¤ä¼˜åŒ–ä¸ºï¼šç©å®¶é˜²å®ˆï¼Œæ•Œäººå¿…æ”»å‡»ï¼

ç©å®¶é˜²å®ˆæƒ…å†µä¸­çš„ä»£ç å¯ä»¥è¿˜åŸä¸ºå‰é¢çš„ç‰ˆæœ¬ï¼Œé‡Œé¢ä¸å†åŒ…å«åˆ¤æ–­æ•ŒäººçŠ¶æ€çš„æ­¥éª¤ã€‚

```python
    elif user_input == 'D':
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)
```

å‘ç°ï¼šå¯èƒ½æœ€å¼€å§‹çš„æ˜¯æœ€å¥½çš„ã€‚

ç›®å‰å®Œæ•´ä»£ç ï¼š

```python
import random

class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp

    def attack(self):
        attack_value = random.randint(0, 50)
        return attack_value

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))

    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp}")



player = Creature('Ran',100)
enemy = Creature('Monster',80)

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    user_input = input('Attack or Defence (A/D): ').strip().upper()
    while user_input not in ('A', 'D'):
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ A æˆ– D').strip().upper()

    enemy_status = random.choice(['A', 'D'])
    if user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)


if player.hp > 0:
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose! ")
```



#### 9.4.7 ç©å®¶å›è¡€æŠ€èƒ½

å½“ç©å®¶è¡€é‡ä½äº50%æ—¶ï¼Œæç¤ºç©å®¶å¯ä»¥è¾“å…¥â€œHâ€æ¥ä½¿ç”¨æ²»ç–—æŠ€èƒ½ï¼Œç›´æ¥å›è¡€ 100% ï¼ˆæ»¡è¡€ï¼‰ã€‚

è¦æ±‚ï¼š

1. åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼
2. æ— æ³•éšæ—¶ä½¿ç”¨å›è¡€æŠ€èƒ½ï¼Œåªæœ‰åœ¨æç¤ºå‡ºç°æ—¶æ‰èƒ½å¤Ÿä½¿ç”¨ã€‚
3. è¡€é‡ä½äºä¸€èˆ¬æŒ‰ç…§åˆå§‹åŒ–ä¼ å…¥çš„å‚æ•°å†³å®šï¼Œéšå…¶å˜åŒ–ã€‚



ç¬¬ä¸€æ­¥ï¼šå¢åŠ åˆå§‹è¡€é‡å€¼

::: code-tabs

@tab ä¸ªäººæ–¹æ³•

```python
player = Creature('Ran',100)
enemy = Creature('Monster',80)
player_initial_hp = player.hp         # è¿™é‡Œæ˜¯ä¸€ä¸ªå€¼ï¼Œæˆç«‹ï¼Œè‹¥æ˜¯å­—å…¸/åˆ—è¡¨åˆ™éœ€è¦è€ƒè™‘æ·±æµ…æ‹·è´é—®é¢˜
```

@tab è€å¸ˆæ–¹æ³•

```python
class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp
        self.max_hp = hp              # å¢åŠ  max_hp è¿™ä¸ªå˜é‡
```



:::

ç¬¬äºŒæ­¥ï¼šç±»é‡Œå¢åŠ ä¸€ä¸ªå‡½æ•°

```python
    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp
```



ç¬¬ä¸‰æ­¥ï¼šæ˜¾ç¤ºè¡€é‡çš„å‡½æ•°éšä¹‹å¯ä»¥ä¼˜åŒ–ï¼Œæ˜¾ç¤ºå½“å‰è¡€é‡/åŸå§‹è¡€é‡ã€‚

```python
    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp/self.max_hp}")
```



ç¬¬å››æ­¥ï¼šå› ä¸ºåªèƒ½æç¤ºä¸€æ¬¡ï¼Œæ‰€ä»¥å¢åŠ ä¸€ä¸ªå˜é‡ `heal_used` åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºè¿‡äº†ã€‚ä¸ªäººä¿®æ”¹æ—¶çº ç»“çš„é—®é¢˜åœ¨äºï¼Œåœ¨å¾ªç¯å†…è®¾ç½®äº†è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆå¾ªç¯æ—¶ä¼šè¢«è¦†ç›–ï¼Œé‡æ–°åˆå§‹åŒ–ï¼Œè§£å†³çš„æ–¹æ³•å°±æ˜¯æŠŠè¿™ä¸ªå˜é‡æ”¾åˆ°å¾ªç¯å¤–é¢ã€‚

```python
player = Creature('Ran',100)
enemy = Creature('Monster',80)
heal_used = False
```



åé¢å…·ä½“å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š

::: code-tabs

@tab ä¸ªäººä»£ç 

```python
    if (player.hp < player.max_hp*0.5) and (not heal_used):    # åŸæœ¬åŒ…å«2ä¸ªif ï¼Œå¯ä»¥é€šè¿‡ and çš„ä½¿ç”¨è¿›è¡Œåˆå¹¶
        recover = input('è¡€é‡ä½äº 50% ï¼Œå¯ä»¥è¾“å…¥ H ä½¿ç”¨æ²»ç–—æŠ€èƒ½ï¼Œç›´æ¥æ¢å¤æ»¡è¡€çŠ¶æ€ï¼š').strip().upper()
        if recover == 'H':
            player.heal_full()
        heal_used = True
```



@tab è€å¸ˆä»£ç 

`````Python
# å°†å›è¡€å’Œæ”»å‡»/é˜²å®ˆè¿›è¡Œåˆå¹¶

player = Creature('Ran',100)
enemy = Creature('Monster',80)
heal_used = False       # é™åˆ¶å›è¡€åªèƒ½ç”¨ä¸€æ¬¡

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰è¡€é‡<åˆå§‹å€¼50% å¹¶ä¸”å°šæœªä½¿ç”¨å›è¡€åŠŸèƒ½
    can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)

    if can_heal_now:
        prompt = 'Attack or Defence or Heal (A/D/H): '
        valid_inputs = {'A', 'D', 'H'}
        extra_tip = 'ï¼ˆæç¤ºï¼šç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰'
        print(extra_tip)

    else:
        prompt = 'Attack or Defence (A/D): '
        valid_inputs = {'A', 'D'}

    user_input = input(prompt).strip().upper()
    while user_input not in valid_inputs:
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥: ' + prompt).strip().upper()

    enemy_status = random.choice(['A', 'D'])

    if user_input == 'H':
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥è¿™é‡Œ
        print('ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼Œè¡€é‡å·²ç»å›æ»¡ã€‚')
        player.heal_full()
        heal_used = True

    elif user_input == 'A':

`````



:::



ç›®å‰å®Œæ•´ä»£ç ï¼š

::: code-tabs

@tab ä¸ªäººå®Œæ•´ä»£ç 

```python
import random

class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp
        self.max_hp = hp              # è®°å½•åˆå§‹è¡€é‡

    def attack(self):
        attack_value = random.randint(0, 50)
        return attack_value

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))

    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp/self.max_hp}")

    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp




player = Creature('Ran',100)
enemy = Creature('Monster',80)
heal_used = False

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    user_input = input('Attack or Defence (A/D): ').strip().upper()
    while user_input not in ('A', 'D'):
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ A æˆ– D').strip().upper()

    enemy_status = random.choice(['A', 'D'])
    if user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)


    if (player.hp < player.max_hp*0.5) and (not heal_used):
        recover = input('è¡€é‡ä½äº 50% ï¼Œå¯ä»¥è¾“å…¥ H ä½¿ç”¨æ²»ç–—æŠ€èƒ½ï¼Œç›´æ¥æ¢å¤æ»¡è¡€çŠ¶æ€ï¼š').strip().upper()
        if recover == 'H':
            player.heal_full()
        heal_used = True


if player.hp > 0:
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose! ")

```

@tab è€å¸ˆå®Œæ•´ä»£ç 

```python
import random

class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp
        self.max_hp = hp              # è®°å½•åˆå§‹è¡€é‡

    def attack(self):
        attack_value = random.randint(0, 50)
        return attack_value

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))

    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp/self.max_hp}")

    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp


player = Creature('Ran',100)
enemy = Creature('Monster',80)
heal_used = False       # é™åˆ¶å›è¡€åªèƒ½ç”¨ä¸€æ¬¡

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰è¡€é‡<åˆå§‹å€¼50% å¹¶ä¸”å°šæœªä½¿ç”¨å›è¡€åŠŸèƒ½
    can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)

    if can_heal_now:
        prompt = 'Attack or Defence or Heal (A/D/H): '
        valid_inputs = {'A', 'D', 'H'}
        extra_tip = 'ï¼ˆæç¤ºï¼šç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰'
        print(extra_tip)

    else:
        prompt = 'Attack or Defence (A/D): '
        valid_inputs = {'A', 'D'}

    user_input = input(prompt).strip().upper()
    while user_input not in valid_inputs:
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥: ' + prompt).strip().upper()

    enemy_status = random.choice(['A', 'D'])

    if user_input == 'H':
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥è¿™é‡Œ
        print('ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼Œè¡€é‡å·²ç»å›æ»¡ã€‚')
        player.heal_full()
        heal_used = True

    elif user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
            print(f'{enemy.name} chose to attack!')
            enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)



if player.hp > 0:
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose! ")

```



:::

ä½†æ˜¯ä¸Šè¿°è€å¸ˆçš„ä»£ç ä¹Ÿæœ‰ä¸ªå°é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰é€‰æ‹©å›è¡€çš„è¯ï¼Œå°±ä¼šä¸€ç›´æç¤ºå¯ä»¥ä½¿ç”¨å›è¡€ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæç¤ºå’Œå›è¡€çš„é€‰æ‹©åªå‡ºç°ä¸€æ¬¡ï¼Œå°±æ˜¯è¿‡è¿™æ‘æ²¡è¿™åº—çš„æƒ…å†µï¼Œå°±å¯ä»¥å°† `heal_used = True` ä»ç©å®¶é€‰æ‹© `H` çš„åˆ¤æ–­ä¸­æå‡ºæ¥ï¼Œå¯ä»¥æ”¾åœ¨æç¤ºå‡ºç°åã€‚

---

æ­¤å¤–ï¼Œåœ¨å°†å›è¡€åŠŸèƒ½åŠ å…¥æ—¶ï¼Œéœ€è¦è€ƒè™‘ç”¨æˆ·è¾“å…¥ `H` çš„æƒ…å†µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç”¨æˆ·è¾“å…¥çš„æç¤ºè¯­ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```Python
import random


class Creature():
    def __init__(self, hp, name):
        self.hp = hp
        self.max_hp = hp  # è®°å½•åˆå§‹æ»¡è¡€
        self.name = name

    def attack(self):
        return random.randint(0, 50)

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, dmg: float):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´ä»¥é¿å…æµ®ç‚¹ HPï¼‰ï¼Œå¹¶ä¿è¯ HP ä¸ä¼šæ‰åˆ°è´Ÿæ•°ä»¥ä¸‹"""
        self.hp = max(0, int(self.hp - dmg))

    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp

    def show_status(self):
        # print(f"{self.name}'s HP â†’ {self.hp}")
        print(f"{self.name}'s HP â†’ {self.hp}/{self.max_hp}")


heal_used = False  # æ²»ç–—ä»…é™ä¸€æ¬¡

player = Creature(100, "AIæ‚¦åˆ›")
enemy = Creature(80, "Enemy")

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    prompt = "Attack or Defence (A/D)ï¼š"

    if (player.hp < player.max_hp * 0.5) and (not heal_used):
        print("ï¼ˆæç¤ºï¼šä½ ç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰")
        prompt = "Attack or Defence or Heal (A/D/H)ï¼š"

    user_input = input(prompt).strip().upper()
    while user_input not in ("A", "D", "H"):
        user_input = input("è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ A æˆ– Dï¼š").strip().upper()

    enemy_status = ['Attack', 'Defence']
    enemy_choice = random.choice(enemy_status)
    if user_input == "A":
        player_attack_coefficient = 1  # MR å–å
        if enemy_choice == "Defence":
            print(f"{enemy.name} chose to defend!")
            player_attack_coefficient = 0.5
        else:
            print(f"{enemy.name} chose to attack!")
            enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)
        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)

    elif user_input == "D":
        enemy_attack_value = enemy.attack() * 0.1
        player.being_attack(enemy_attack_value)

    elif user_input == "H":
        player.heal_full()
        heal_used = True
        print(f"{player.name} healed to full health!")
        prompt = "Attack or Defence (A/D)ï¼š"

if player.not_dead():
    print("You Win!")
else:
    print("You Lose!")

```





#### 9.4.8 å›è¡€æŠ€èƒ½ä»£ä»·

å›è¡€æ˜¯æœ‰ä»£ä»·çš„ï¼Œå¦‚æœç©å®¶ä½¿ç”¨äº†å›è¡€æŠ€èƒ½ï¼Œåç»­æ•Œäººä¸€å®šä¼šæ”»å‡»ï¼Œå¹¶ä¸”æ”»å‡»å°†ç¿»å€ã€‚

å¯ä»¥åœ¨æ•Œäººæ”»å‡»æ—¶ï¼Œåˆ¤æ–­å›è¡€æŠ€èƒ½æ˜¯å¦ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨äº†ï¼Œé‚£ä¹ˆæ”»å‡» ä¹˜2ã€‚

ä¸‹è¿°ä»£ç æ˜¯åœ¨ `heal_used = True` æ”¾åœ¨è¾“å…¥æ˜¯ `H` ä¸‹çš„åˆ¤æ–­ä¸­çš„æƒ…å†µï¼š 

```Python
    if user_input == 'H':
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥è¿™é‡Œ
        print('ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼Œè¡€é‡å·²ç»å›æ»¡ã€‚')
        player.heal_full()
        heal_used = True

    elif user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            if heal_used:         # åˆ¤æ–­æ˜¯å¦å›è¡€æ²»ç–—äº†
                enemy_attack_value = 2 * enemy.attack()
            else:
                enemy_attack_value = enemy.attack()
            player.being_attack(enemy_attack_value)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
            print(f'{enemy.name} chose to attack!')
            if heal_used:         # åˆ¤æ–­æ˜¯å¦å›è¡€æ²»ç–—äº†
                enemy_attack_value = 2*(0.1*enemy.attack())
            else:
                enemy_attack_value = 0.1*enemy.attack()
            player.being_attack(enemy_attack_value)
```

å¦‚æœæˆ‘ä»¬æƒ³è¦æŒ‡å®šâ€œè¿‡è¿™æ‘æ²¡è¿™åº—â€çš„æƒ…å†µï¼Œé‚£ä¹ˆåƒæˆ‘ä»¬ä¸Šé¢æåˆ°è¿‡çš„ `heal_used = True`  è¢«æåˆ°å¤–é¢ï¼Œå°±éœ€è¦å°†â€œæç¤ºè¿‡â€å’Œâ€œä½¿ç”¨å›è¡€â€åŒºåˆ†å¼€ï¼Œå› æ­¤éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°å˜é‡ `heal_penalty_active` ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```Python
player = Creature('Ran',100)
enemy = Creature('Monster',80)
heal_used = False       # é™åˆ¶å›è¡€åªèƒ½ç”¨ä¸€æ¬¡
heal_penalty_active = False      # å›è¡€ä»£ä»·æ¿€æ´»çŠ¶æ€

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰è¡€é‡<åˆå§‹å€¼50% å¹¶ä¸”å°šæœªä½¿ç”¨å›è¡€åŠŸèƒ½
    can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)

    if can_heal_now:
        prompt = 'Attack or Defence or Heal (A/D/H): '
        valid_inputs = {'A', 'D', 'H'}
        extra_tip = 'ï¼ˆæç¤ºï¼šç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰'
        print(extra_tip)
        heal_used = True  # è¯´æ˜å›è¡€æç¤ºå‡ºç°äº†ï¼Œä¹‹åä¸ä¼šå†å‡ºç°

    else:
        prompt = 'Attack or Defence (A/D): '
        valid_inputs = {'A', 'D'}

    if heal_penalty_active:
        print('ã€è­¦å‘Šã€‘æ²»ç–—ä»£ä»·ç”Ÿæ•ˆä¸­ï¼Œæ•Œäººå¯¹ä½ çš„ä¼¤å®³ Ã—2 ï¼')


    user_input = input(prompt).strip().upper()
    while user_input not in valid_inputs:
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥: ' + prompt).strip().upper()

    # æ•Œäººé€‰æ‹©ï¼ˆè‹¥ç©å®¶é€‰æ‹© D æˆ–è€… H ï¼Œæ•Œäººéƒ½ç›´æ¥æ”»å‡»ï¼‰
    enemy_status = random.choice(['A', 'D'])

    # å½“å‰æ•Œäººä¼¤å®³å€ç‡ï¼ˆæ˜¯å¦ç¿»å€ï¼‰
    def enemy_mul():
        return 2.0 if heal_penalty_active else 1.0

    if user_input == 'H':
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥è¿™é‡Œ
        print('ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼Œè¡€é‡å·²ç»å›æ»¡ã€‚')
        player.heal_full()
        heal_penalty_active = True             # è§¦å‘æ²»ç–—ä»£ä»·

        # æ•Œäººå›åˆï¼šç›´æ¥æ”»å‡»ï¼Œå…ˆæ²»ç–—å†æŒ¨æ‰“
        raw_enemy_attack_value = enemy.attack()
        damage = raw_enemy_attack_value * enemy_mul()
        print(f'{enemy.name}æ”»å‡»äº†ä½ ï¼Œé€ æˆ{int(damage)}ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)}Ã—å€ç‡{enemy_mul():.0f}ï¼‰')
        player.being_attack(damage)


    elif user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            raw_enemy_attack_value = enemy.attack()
            damage = raw_enemy_attack_value * enemy_mul()
            print(f'{enemy.name}æ”»å‡»äº†ä½ ï¼Œé€ æˆ{int(damage)}ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)}Ã—å€ç‡{enemy_mul():.0f}ï¼‰')
            player.being_attack(damage)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
        # é˜²å¾¡ï¼šæ•Œäººæ”»å‡»å‡ä¼¤ä¸º 90% ï¼Œç„¶åå†åº”ç”¨ç¿»å€å€ç‡
        print(f'{enemy.name} chose to attack!')
        raw_enemy_attack_value = enemy.attack()
        damage = (raw_enemy_attack_value*0.1) * enemy_mul()
        print(f'{enemy.name}æ”»å‡»äº†ä½ ï¼ˆè¢«ä½ é˜²ä½å¤§éƒ¨åˆ†ï¼‰ï¼Œé€ æˆ{int(damage)}ç‚¹ä¼¤å®³ï¼'
              f'ï¼ˆåŸå§‹{int(raw_enemy_attack_value)}Ã—å€ç‡{enemy_mul():.0f}ï¼‰')
        player.being_attack(damage)
```



ç›®å‰å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```Python
import random

class Creature():
    def __init__(self, name, hp):
        self.name = name
        self.hp = hp
        self.max_hp = hp              # è®°å½•åˆå§‹è¡€é‡

    def attack(self):
        attack_value = random.randint(0, 50)
        return attack_value

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, attack_value):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´é¿å…è¡€é‡æ˜¾ç¤ºä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¿è¯äº†è¡€é‡ä¸ä¼šå‡ºç°è´Ÿæ•°"""
        self.hp = max(0, int(self.hp-attack_value))

    def show_status(self):
        print(f"{self.name}'s HP â†’ {self.hp}/{self.max_hp}")

    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp



player = Creature('Ran',100)
enemy = Creature('Monster',80)
heal_used = False       # é™åˆ¶å›è¡€åªèƒ½ç”¨ä¸€æ¬¡
heal_penalty_active = False      # å›è¡€ä»£ä»·æ¿€æ´»çŠ¶æ€

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰è¡€é‡<åˆå§‹å€¼50% å¹¶ä¸”å°šæœªä½¿ç”¨å›è¡€åŠŸèƒ½
    can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)

    if can_heal_now:
        prompt = 'Attack or Defence or Heal (A/D/H): '
        valid_inputs = {'A', 'D', 'H'}
        extra_tip = 'ï¼ˆæç¤ºï¼šç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰'
        print(extra_tip)
        heal_used = True  # è¯´æ˜å›è¡€æç¤ºå‡ºç°äº†ï¼Œä¹‹åä¸ä¼šå†å‡ºç°

    else:
        prompt = 'Attack or Defence (A/D): '
        valid_inputs = {'A', 'D'}

    if heal_penalty_active:
        print('ã€è­¦å‘Šã€‘æ²»ç–—ä»£ä»·ç”Ÿæ•ˆä¸­ï¼Œæ•Œäººå¯¹ä½ çš„ä¼¤å®³ Ã—2 ï¼')


    user_input = input(prompt).strip().upper()
    while user_input not in valid_inputs:
        user_input = input('è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥: ' + prompt).strip().upper()

    # æ•Œäººé€‰æ‹©ï¼ˆè‹¥ç©å®¶é€‰æ‹© D æˆ–è€… H ï¼Œæ•Œäººéƒ½ç›´æ¥æ”»å‡»ï¼‰
    enemy_status = random.choice(['A', 'D'])

    # å½“å‰æ•Œäººä¼¤å®³å€ç‡ï¼ˆæ˜¯å¦ç¿»å€ï¼‰
    def enemy_mul():
        return 2.0 if heal_penalty_active else 1.0

    if user_input == 'H':
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥è¿™é‡Œ
        print('ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼Œè¡€é‡å·²ç»å›æ»¡ã€‚')
        player.heal_full()
        heal_penalty_active = True             # è§¦å‘æ²»ç–—ä»£ä»·

        # æ•Œäººå›åˆï¼šç›´æ¥æ”»å‡»ï¼Œå…ˆæ²»ç–—å†æŒ¨æ‰“
        raw_enemy_attack_value = enemy.attack()
        damage = raw_enemy_attack_value * enemy_mul()
        print(f'{enemy.name}æ”»å‡»äº†ä½ ï¼Œé€ æˆ{int(damage)}ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)}Ã—å€ç‡{enemy_mul():.0f}ï¼‰')
        player.being_attack(damage)


    elif user_input == 'A':
        player_attack_coefficient = 1
        if enemy_status == 'D':
            print(f'{enemy.name} chose to defend!')
            player_attack_coefficient = 0.5
        else:
            print(f'{enemy.name} chose to attack!')
            raw_enemy_attack_value = enemy.attack()
            damage = raw_enemy_attack_value * enemy_mul()
            print(f'{enemy.name}æ”»å‡»äº†ä½ ï¼Œé€ æˆ{int(damage)}ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)}Ã—å€ç‡{enemy_mul():.0f}ï¼‰')
            player.being_attack(damage)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)


    elif user_input == 'D':
        # é˜²å¾¡ï¼šæ•Œäººæ”»å‡»å‡ä¼¤ä¸º 90% ï¼Œç„¶åå†åº”ç”¨ç¿»å€å€ç‡
        print(f'{enemy.name} chose to attack!')
        raw_enemy_attack_value = enemy.attack()
        damage = (raw_enemy_attack_value*0.1) * enemy_mul()
        print(f'{enemy.name}æ”»å‡»äº†ä½ ï¼ˆè¢«ä½ é˜²ä½å¤§éƒ¨åˆ†ï¼‰ï¼Œé€ æˆ{int(damage)}ç‚¹ä¼¤å®³ï¼'
              f'ï¼ˆåŸå§‹{int(raw_enemy_attack_value)}Ã—å€ç‡{enemy_mul():.0f}ï¼‰')
        player.being_attack(damage)



if player.not_dead():
    print(f"You win! Your HP: {player.hp}")
else:
    print(f"You lose! ")
```

å…¶ä»–ä¼˜åŒ–ï¼šè­¦å‘Šåªæ˜¾ç¤ºä¸€æ¬¡å¦‚ä½•å¤„ç†ï¼Ÿ

è§£å†³æ–¹æ³•ï¼šå°†è­¦å‘Šç§»åˆ° `H` é‡Œé¢å³å¯ï¼š

```Python
    if user_input == 'H':
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥è¿™é‡Œ
        print('ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼Œè¡€é‡å·²ç»å›æ»¡ã€‚')
        player.heal_full()
        heal_penalty_active = True             # è§¦å‘æ²»ç–—ä»£ä»·
        print('ã€è­¦å‘Šã€‘æ²»ç–—ä»£ä»·ç”Ÿæ•ˆä¸­ï¼Œæ•Œäººå¯¹ä½ çš„ä¼¤å®³ Ã—2 ï¼')
```



#### 9.4.9 è¡€é‡è¿›åº¦æ¡

è€å¸ˆç¤ºä¾‹

- å®Œæ•´ä»£ç ï¼š

    ```python
    import random
    import sys
    
    # ====== ç»ˆç«¯é¢œè‰²ä¸è¿›åº¦æ¡å·¥å…· ======
    RESET = "\033[0m"
    FG_RED = "\033[31m"
    FG_YELLOW = "\033[33m"
    FG_GREEN = "\033[32m"
    FG_CYAN = "\033[36m"
    FG_MAGENTA = "\033[35m"
    
    def _supports_color() -> bool:
        # åŸºæœ¬åˆ¤æ–­ï¼šæ˜¯äº¤äº’ç»ˆç«¯å°±ä¸Šè‰²ï¼›å¦åˆ™é€€åŒ–ä¸ºæ— è‰²
        return sys.stdout.isatty()
    
    def colorize(s: str, color: str) -> str:
        if _supports_color():
            return f"{color}{s}{RESET}"
        return s
    
    def hp_bar(cur: int, maxv: int, width: int = 30) -> str:
        cur = max(0, min(cur, maxv))
        ratio = cur / maxv if maxv > 0 else 0
        filled = int(round(ratio * width))
        empty = width - filled
    
        # é˜ˆå€¼é…è‰²ï¼š>50% ç»¿ï¼›20%~50% é»„ï¼›<=20% çº¢
        if ratio > 0.5:
            bar_color = FG_GREEN
        elif ratio > 0.2:
            bar_color = FG_YELLOW
        else:
            bar_color = FG_RED
    
        bar = "â–ˆ" * filled + "â–‘" * empty
        percent = f"{int(ratio * 100):3d}%"
        return f"[{colorize(bar, bar_color)}] {percent}  {cur}/{maxv}"
    
    # ====== ä½ çš„æ¸¸æˆä»£ç ï¼ˆåŠ å…¥è¿›åº¦æ¡æ˜¾ç¤ºï¼‰ ======
    class Creature:
        def __init__(self, hp, name):
            self.hp = int(hp)
            self.max_hp = int(hp)  # è®°å½•åˆå§‹æ»¡è¡€
            self.name = name
    
        def attack(self):
            return random.randint(0, 50)
    
        def not_dead(self):
            return self.hp > 0
    
        def being_attack(self, dmg: float):
            """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´ä»¥é¿å…æµ®ç‚¹ HPï¼‰ï¼Œå¹¶ä¿è¯ HP ä¸ä¼šæ‰åˆ°è´Ÿæ•°ä»¥ä¸‹"""
            self.hp = max(0, int(self.hp - dmg))
    
        def heal_full(self):
            """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
            self.hp = self.max_hp
    
        def show_status(self):
            # åç§°åŠ ä¸€ç‚¹é…è‰²åŒºåˆ†ç©å®¶/æ•Œäºº
            name_str = self.name
            if self.name == "AIæ‚¦åˆ›":
                name_str = colorize(self.name, FG_CYAN)
            elif self.name.lower().startswith("enemy"):
                name_str = colorize(self.name, FG_MAGENTA)
    
            print(f"{name_str} HP {hp_bar(self.hp, self.max_hp)}")
    
    player = Creature(100, "AIæ‚¦åˆ›")
    enemy = Creature(80, "Enemy")
    
    heal_used = False  # æ²»ç–—ä»…é™ä¸€æ¬¡
    heal_penalty_active = False  # æ˜¯å¦å·²è§¦å‘â€œæ•Œäººæ”»å‡»ç¿»å€â€çš„æƒ©ç½š
    
    while player.not_dead() and enemy.not_dead():
        print("\n=== çŠ¶æ€ ===")
        player.show_status()
        enemy.show_status()
    
        # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰ HP < åˆå§‹ HP çš„ 50% ä¸”å°šæœªä½¿ç”¨
        can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)
    
        if can_heal_now:
            prompt = 'Attack or Defence or Heal (A/D/H)ï¼š'
            valid_inputs = {"A", "D", "H"}
            print(colorize('ï¼ˆæç¤ºï¼šä½ ç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰', FG_YELLOW))
        else:
            prompt = 'Attack or Defence (A/D)ï¼š'
            valid_inputs = {"A", "D"}
    
        if heal_penalty_active:
            print(colorize('ã€è­¦å‘Šã€‘æ²»ç–—ä»£ä»·ç”Ÿæ•ˆä¸­ï¼šæ•Œäººå¯¹ä½ çš„ä¼¤å®³ Ã—2ï¼', FG_RED))
    
        user_input = input(prompt).strip().upper()
        while user_input not in valid_inputs:
            user_input = input("è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ï¼š" + prompt).strip().upper()
    
        # æ•Œäººé€‰æ‹©ï¼ˆå¯¹ A/D æœ‰å½±å“ï¼›è‹¥ç©å®¶é€‰æ‹© Hï¼Œæˆ‘ä»¬è®©æ•Œäººæœ¬å›åˆç›´æ¥æ”»å‡»ï¼‰
        enemy_status = ['Attack', 'Defence']
        enemy_choice = random.choices(enemy_status, weights=[0.7, 0.3], k=1)[0]  # æ•Œäººæ›´å€¾å‘äºæ”»å‡»
    
        # å½“å‰æ•Œäººä¼¤å®³å€ç‡ï¼ˆæ˜¯å¦ç¿»å€ï¼‰
        def enemy_mul():
            return 2.0 if heal_penalty_active else 1.0
    
        if user_input == "H":
            # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥åˆ°è¿™é‡Œï¼ˆä¸Šé¢å·²é™åˆ¶è¾“å…¥é€‰é¡¹ï¼‰
            print(colorize("ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼è¡€é‡å·²å›æ»¡ã€‚", FG_GREEN))
            player.heal_full()
            heal_used = True
    
            # è§¦å‘æ²»ç–—ä»£ä»·ï¼šä»ç°åœ¨èµ·æ•Œäººæ”»å‡»ç¿»å€ï¼ˆåŒ…å«æœ¬å›åˆçš„éšåçš„æ•Œäººæ”»å‡»ï¼‰
            heal_penalty_active = True
    
            # æ•Œäººå›åˆï¼šç›´æ¥æ”»å‡»ï¼ˆå…ˆæ²»å†æŒ¨æ‰“ï¼‰
            raw_enemy_attack_value = enemy.attack()
            damage = raw_enemy_attack_value * enemy_mul()
            print(f"{enemy.name} æ”»å‡»äº†ä½ ï¼Œé€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
            player.being_attack(damage)
    
        elif user_input == "A":
            player_attack_coefficient = 1
            if enemy_choice == "Defence":
                print(f"{enemy.name} chose to defend!")
                player_attack_coefficient = 0.5
            else:
                print(f"{enemy.name} chose to attack!")
                raw_enemy_attack_value = enemy.attack()
                damage = raw_enemy_attack_value * enemy_mul()
                print(f"{enemy.name} å¯¹ä½ é€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
                player.being_attack(damage)
    
            player_attack_value = player.attack()
            enemy.being_attack(player_attack_value * player_attack_coefficient)
            print(f"ä½ å¯¹ {enemy.name} é€ æˆ {int(player_attack_value * player_attack_coefficient)} ç‚¹ä¼¤å®³ã€‚")
    
        elif user_input == "D":
            # é˜²å¾¡ï¼šæ•Œäººæ”»å‡»å‡ä¼¤ä¸º 90%ï¼Œç„¶åå†åº”ç”¨ç¿»å€å€ç‡
            raw_enemy_attack_value = enemy.attack()
            damage = raw_enemy_attack_value * 0.1 * enemy_mul()
            print(f"{enemy.name} æ”»å‡»äº†ä½ ï¼ˆè¢«ä½ é˜²ä½å¤§éƒ¨åˆ†ï¼‰ï¼Œé€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼"
                  f"ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å‡ä¼¤0.1 Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
            player.being_attack(damage)
    
    if player.not_dead():
        print(colorize("You Win!", FG_GREEN))
    else:
        print(colorize("You Lose!", FG_RED))
    ```

    

- æ³¨é‡Šï¼š

    ```python
    import sys  # ç”¨äºåˆ¤æ–­æ ‡å‡†è¾“å‡ºæ˜¯å¦æ˜¯ä¸€ä¸ªâ€œäº¤äº’å¼ç»ˆç«¯â€ï¼ˆTTYï¼‰ï¼Œä»è€Œå†³å®šæ˜¯å¦ä½¿ç”¨é¢œè‰²
    
    # ====== ç»ˆç«¯é¢œè‰²ä¸è¿›åº¦æ¡å·¥å…· ======
    RESET = "\033[0m"     # ANSI è½¬ä¹‰åºåˆ—ï¼šé‡ç½®æ‰€æœ‰é¢œè‰²/æ ·å¼
    FG_RED = "\033[31m"   # å‰æ™¯è‰²ï¼šçº¢
    FG_YELLOW = "\033[33m"# å‰æ™¯è‰²ï¼šé»„
    FG_GREEN = "\033[32m" # å‰æ™¯è‰²ï¼šç»¿
    FG_CYAN = "\033[36m"  # å‰æ™¯è‰²ï¼šé’ï¼ˆç»™ç©å®¶åä¸Šè‰²ç”¨ï¼‰
    FG_MAGENTA = "\033[35m"# å‰æ™¯è‰²ï¼šæ´‹çº¢ï¼ˆç»™æ•Œäººåä¸Šè‰²ç”¨ï¼‰
    
    def _supports_color() -> bool:
        """
        åˆ¤æ–­å½“å‰ stdout æ˜¯å¦æ˜¯ä¸€ä¸ª TTYï¼ˆäº¤äº’å¼ç»ˆç«¯ï¼‰ã€‚
        - å¦‚æœæ˜¯ TTYï¼Œé€šå¸¸å¯ä»¥æ­£ç¡®è§£æ ANSI é¢œè‰²è½¬ä¹‰åºåˆ— -> è¿”å› Trueã€‚
        - å¦‚æœä¸æ˜¯ï¼ˆæ¯”å¦‚å†™å…¥æ–‡ä»¶ã€è¢«é‡å®šå‘åˆ°æ—¥å¿—ç³»ç»Ÿï¼‰ï¼Œå°±ä¸è¦è¾“å‡ºé¢œè‰²ç  -> è¿”å› Falseã€‚
        è¿™æ ·å¯ä»¥é¿å…åœ¨ä¸æ”¯æŒé¢œè‰²çš„ç¯å¢ƒé‡Œçœ‹åˆ°ä¸€å †â€œ\x1b[31mâ€ä¹‹ç±»çš„ä¹±ç ã€‚
        """
        return sys.stdout.isatty()
    
    def colorize(s: str, color: str) -> str:
        """
        æ ¹æ® _supports_color() çš„ç»“æœï¼Œæœ‰é€‰æ‹©åœ°ç»™å­—ç¬¦ä¸²åŠ é¢œè‰²ã€‚
        - æ”¯æŒé¢œè‰²ï¼šå‰ååŒ…è£¹ color ä¸ RESET è½¬ä¹‰ç ã€‚
        - ä¸æ”¯æŒé¢œè‰²ï¼šåŸæ ·è¿”å›ï¼Œé¿å…æ±¡æŸ“è¾“å‡ºã€‚
        """
        if _supports_color():
            return f"{color}{s}{RESET}"
        return s
    
    def hp_bar(cur: int, maxv: int, width: int = 30) -> str:
        """
        ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬è¿›åº¦æ¡ï¼Œå½¢å¦‚ï¼š
        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  40%  40/100
    
        å‚æ•°ï¼š
        - cur: å½“å‰ HPï¼ˆä¼šè¢«é™åˆ¶åœ¨ 0..maxv èŒƒå›´ï¼Œä»¥é¿å…è¶Šç•Œï¼‰
        - maxv: æœ€å¤§ HPï¼ˆåˆ†æ¯ï¼›æ³¨æ„åš 0 ä¿æŠ¤ï¼‰
        - width: è¿›åº¦æ¡å®½åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰ï¼Œé»˜è®¤ 30
    
        è¿”å›ï¼š
        - åŒ…å«å½©è‰²æ¡å½¢ã€ç™¾åˆ†æ¯”å’Œâ€œcur/maxvâ€æ•°å€¼çš„å­—ç¬¦ä¸²
        """
        # 1) é˜²å¾¡å¼ç¼–ç¨‹ï¼šå…ˆæŠŠ cur é™åˆ¶åœ¨ [0, maxv]ï¼Œé¿å…å‡ºç°è´Ÿæ•°/è¶…ä¸Šé™
        cur = max(0, min(cur, maxv))
    
        # 2) è®¡ç®—æ¯”ä¾‹ ratioï¼Œæ³¨æ„ maxv=0 çš„å…œåº•ï¼ˆé¿å… ZeroDivisionErrorï¼‰
        ratio = cur / maxv if maxv > 0 else 0
    
        # 3) æ ¹æ®æ¯”ä¾‹è®¡ç®—â€œå¡«å……å—â€æ•°é‡
        #    - round è€Œé floorï¼šè®©ä¸´ç•Œå€¼ï¼ˆä¾‹å¦‚ 100%ï¼‰å¯ä»¥å¡«æ»¡æ•´æ¡ï¼›å¦åˆ™å®¹æ˜“å‡ºç° 99% çœ‹èµ·æ¥æ²¡æ»¡çš„â€œå¼ºè¿«ç—‡â€æ•ˆæœ
        #    - å†ç”¨ int è½¬æˆæ•´æ•°ä¸ªå­—ç¬¦
        filled = int(round(ratio * width))
        empty = width - filled  # å‰©ä½™æœªå¡«å……éƒ¨åˆ†
    
        # 4) é˜ˆå€¼é…è‰²ï¼š
        #    ratio > 0.5  â†’ ç»¿è‰²ï¼ˆå®‰å…¨ï¼‰
        #    0.2 < ratio <= 0.5 â†’ é»„è‰²ï¼ˆè­¦æˆ’ï¼‰
        #    ratio <= 0.2 â†’ çº¢è‰²ï¼ˆå±é™©ï¼‰
        #    è¿™æ ·åœ¨å¯¹å±€ä¸­èƒ½ç›´è§‚æ„Ÿå—åˆ°â€œå¥åº·ç¨‹åº¦â€
        if ratio > 0.5:
            bar_color = FG_GREEN
        elif ratio > 0.2:
            bar_color = FG_YELLOW
        else:
            bar_color = FG_RED
    
        # 5) ä½¿ç”¨å…¨å— 'â–ˆ' è¡¨ç¤ºå·²å¡«å……ï¼Œç”¨æµ…è‰² 'â–‘' è¡¨ç¤ºæœªå¡«å……ï¼ˆè§†è§‰å¯¹æ¯”æ˜æ˜¾ï¼‰
        #    å¦‚æœä½ çš„ç»ˆç«¯æˆ–å­—ä½“å¯¹è¿™äº›å­—ç¬¦æ”¯æŒä¸å¥½ï¼Œå¯ä»¥æ¢æˆ '#' å’Œ '-' ç­‰ ASCII å­—ç¬¦ã€‚
        bar = "â–ˆ" * filled + "â–‘" * empty
    
        # 6) ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼šå–æ•´åˆ° 0..100 ä¹‹é—´ï¼Œå¹¶ç”¨ :3d åšå®½åº¦å¯¹é½ï¼ˆå³å¯¹é½å  3 æ ¼ï¼Œåƒ " 40%"ï¼‰
        percent = f"{int(ratio * 100):3d}%"
    
        # 7) æŠŠå½©è‰²æ¡å½¢ + ç™¾åˆ†æ¯” + â€œcur/maxvâ€ ç»„è£…æˆæœ€ç»ˆå­—ç¬¦ä¸²
        return f"[{colorize(bar, bar_color)}] {percent}  {cur}/{maxv}"
    ```

    

**è¡¥å……çŸ¥è¯†ï¼š**

[Python ä¿ç•™æŒ‡å®šä½æ•°çš„å°æ•°](https://bornforthis.cn/column/Python-Programming-Course/P02-2-basequestion/radix_point.html)



å››èˆäº”å…¥çš„å–æ•´ `round()` 

**ä¸ªäººä»£ç ï¼š**

åªå¯¹ `show_status` è¿™ä¸ªå‡½æ•°è¿›è¡Œä¿®æ”¹ã€‚

```python
    def show_status(self):
        max_hp_bar = round(self.max_hp/10)
        now_hp_bar = round((self.hp / self.max_hp) * max_hp_bar)
        hp_bar = (now_hp_bar * 'â–ˆ')+((max_hp_bar-now_hp_bar) * 'â–‘')
        print(f"{self.name}'s HP â†’ {hp_bar} {self.hp}/{self.max_hp}")
```



**è€å¸ˆä»£ç ï¼š**

:::code-tabs

@tab ç²¾ç®€ä»£ç 

```python
import random

# â€”â€” ç®€å•æ— è‰²è¿›åº¦æ¡ï¼ˆçº¯ ASCIIï¼Œè·¨å¹³å°ï¼‰â€”â€”
def hp_bar(cur: int, maxv: int, width: int = 20) -> str:
    """è¿”å›å½¢å¦‚ï¼š[##########----------] 50%  50/100 çš„è¿›åº¦æ¡æ–‡æœ¬"""
    if maxv <= 0:
        maxv = 1
    cur = max(0, min(cur, maxv))
    ratio = cur / maxv
    filled = int(ratio * width + 0.5)  # å››èˆäº”å…¥ï¼Œå› ä¸º int çš„å–æ•´æ˜¯æŠŠå°æ•°ç‚¹åçš„ç›´æ¥é”¯æ‰
    bar = "#" * filled + "-" * (width - filled)
    return f"[{bar}] {int(ratio * 100):3d}%  {cur}/{maxv}"


class Creature:
    # ---snip---

    def show_status(self):
        print(f"{self.name}'s HP â†’ {hp_bar(self.hp, self.max_hp)}")
```

@tab å®Œæ•´ä»£ç 

```python
import random

# â€”â€” ç®€å•æ— è‰²è¿›åº¦æ¡ï¼ˆçº¯ ASCIIï¼Œè·¨å¹³å°ï¼‰â€”â€”
def hp_bar(cur: int, maxv: int, width: int = 20) -> str:
    """è¿”å›å½¢å¦‚ï¼š[##########----------] 50%  5g0/100 çš„è¿›åº¦æ¡æ–‡æœ¬"""
    if maxv <= 0:
        maxv = 1
    cur = max(0, min(cur, maxv))
    ratio = cur / maxv
    filled = int(ratio * width + 0.5)  # å››èˆäº”å…¥
    bar = "#" * filled + "-" * (width - filled)
    return f"[{bar}] {int(ratio * 100):3d}%  {cur}/{maxv}"


class Creature:
    def __init__(self, hp, name):
        self.hp = int(hp)
        self.max_hp = int(hp)  # è®°å½•åˆå§‹æ»¡è¡€
        self.name = name

    def attack(self):
        return random.randint(0, 50)

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, dmg: float):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´ä»¥é¿å…æµ®ç‚¹ HPï¼‰ï¼Œå¹¶ä¿è¯ HP ä¸ä¼šæ‰åˆ°è´Ÿæ•°ä»¥ä¸‹"""
        self.hp = max(0, int(self.hp - dmg))

    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp

    def show_status(self):
        print(f"{self.name}'s HP â†’ {hp_bar(self.hp, self.max_hp)}")


player = Creature(100, "AIæ‚¦åˆ›")
enemy = Creature(80, "Enemy")

heal_used = False  # æ²»ç–—ä»…é™ä¸€æ¬¡
heal_penalty_active = False  # æ˜¯å¦å·²è§¦å‘â€œæ•Œäººæ”»å‡»ç¿»å€â€çš„æƒ©ç½š

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰ HP < åˆå§‹ HP çš„ 50% ä¸”å°šæœªä½¿ç”¨
    can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)

    if can_heal_now:
        prompt = 'Attack or Defence or Heal (A/D/H)ï¼š'
        valid_inputs = {"A", "D", "H"}
        print('ï¼ˆæç¤ºï¼šä½ ç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰')
    else:
        prompt = 'Attack or Defence (A/D)ï¼š'
        valid_inputs = {"A", "D"}

    if heal_penalty_active:
        print('ã€è­¦å‘Šã€‘æ²»ç–—ä»£ä»·ç”Ÿæ•ˆä¸­ï¼šæ•Œäººå¯¹ä½ çš„ä¼¤å®³ Ã—2ï¼')

    user_input = input(prompt).strip().upper()
    while user_input not in valid_inputs:
        user_input = input("è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ï¼š" + prompt).strip().upper()

    # æ•Œäººé€‰æ‹©ï¼ˆå¯¹ A/D æœ‰å½±å“ï¼›è‹¥ç©å®¶é€‰æ‹© Hï¼Œæˆ‘ä»¬è®©æ•Œäººæœ¬å›åˆç›´æ¥æ”»å‡»ï¼‰
    enemy_status = ['Attack', 'Defence']
    enemy_choice = random.choices(enemy_status, weights=[0.7, 0.3], k=1)[0]  # æ•Œäººæ›´å€¾å‘äºæ”»å‡»


    # å½“å‰æ•Œäººä¼¤å®³å€ç‡ï¼ˆæ˜¯å¦ç¿»å€ï¼‰
    def enemy_mul():
        return 2.0 if heal_penalty_active else 1.0


    if user_input == "H":
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥åˆ°è¿™é‡Œ
        print("ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼è¡€é‡å·²å›æ»¡ã€‚")
        player.heal_full()
        heal_used = True

        # è§¦å‘æ²»ç–—ä»£ä»·ï¼šä»ç°åœ¨èµ·æ•Œäººæ”»å‡»ç¿»å€ï¼ˆåŒ…å«æœ¬å›åˆçš„éšåçš„æ•Œäººæ”»å‡»ï¼‰
        heal_penalty_active = True

        # æ•Œäººå›åˆï¼šç›´æ¥æ”»å‡»ï¼ˆå…ˆæ²»å†æŒ¨æ‰“ï¼‰
        raw_enemy_attack_value = enemy.attack()
        damage = raw_enemy_attack_value * enemy_mul()
        print(f"{enemy.name} æ”»å‡»äº†ä½ ï¼Œé€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
        player.being_attack(damage)

    elif user_input == "A":
        player_attack_coefficient = 1
        if enemy_choice == "Defence":
            print(f"{enemy.name} chose to defend!")
            player_attack_coefficient = 0.5
        else:
            print(f"{enemy.name} chose to attack!")
            raw_enemy_attack_value = enemy.attack()
            damage = raw_enemy_attack_value * enemy_mul()
            print(f"{enemy.name} å¯¹ä½ é€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
            player.being_attack(damage)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)

    elif user_input == "D":
        # é˜²å¾¡ï¼šæ•Œäººæ”»å‡»å‡ä¼¤ä¸º 90%ï¼Œç„¶åå†åº”ç”¨ç¿»å€å€ç‡
        raw_enemy_attack_value = enemy.attack()
        damage = raw_enemy_attack_value * 0.1 * enemy_mul()
        print(f"{enemy.name} æ”»å‡»äº†ä½ ï¼ˆè¢«ä½ é˜²ä½å¤§éƒ¨åˆ†ï¼‰ï¼Œé€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼"
              f"ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å‡ä¼¤0.1 Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
        player.being_attack(damage)

if player.not_dead():
    print("You Win!")
else:
    print("You Lose!")
```



:::



ä¸‹é¢æŠŠè¿™ä¸ª**æ— è‰²è¿›åº¦æ¡**å®ç°é€è¡Œã€é€ä¸ªè®¾è®¡ç‚¹è®²æ¸…æ¥šã€‚å…ˆæ”¾åŸå‡½æ•°ï¼Œåé¢æŒ‰è¡Œè§£é‡Šä¸ä¸¾ä¾‹ï¼š

```python
def hp_bar(cur: int, maxv: int, width: int = 20) -> str:
    """è¿”å›å½¢å¦‚ï¼š[##########----------] 50%  50/100 çš„è¿›åº¦æ¡æ–‡æœ¬"""
    if maxv <= 0:
        maxv = 1
    cur = max(0, min(cur, maxv))
    ratio = cur / maxv
    filled = int(ratio * width + 0.5)  # å››èˆäº”å…¥
    bar = "#" * filled + "-" * (width - filled)
    return f"[{bar}] {int(ratio * 100):3d}%  {cur}/{maxv}"
```

- **é€è¡Œè¯´æ˜**ï¼š

    1. `def hp_bar(cur: int, maxv: int, width: int = 20) -> str:`

        - `cur`ï¼šå½“å‰è¡€é‡ï¼ˆcurrent HPï¼‰ï¼›

        - `maxv`ï¼šæœ€å¤§è¡€é‡ï¼ˆæœ€å¤§/æ»¡è¡€ï¼‰ï¼›

        - `width`ï¼šè¿›åº¦æ¡å®½åº¦ï¼ˆå­—ç¬¦æ ¼æ•°ï¼‰ï¼Œé»˜è®¤ 20 æ ¼ï¼›

        - çº¯ ASCIIï¼Œä¸å«é¢œè‰²å’Œç‰¹æ®Šå­—ç¬¦ï¼Œ**Mac/Windows ä»»ä½•ç»ˆç«¯éƒ½èƒ½æ˜¾ç¤º**ã€‚

    2. ä»£ç ï¼š

        ```python
        if maxv <= 0:
            maxv = 1
        ```

        - **é˜²å¾¡å¼ç¼–ç¨‹**ï¼šé¿å…å‡ºç° `maxv == 0` å¯¼è‡´åé¢ `cur / maxv` é™¤é›¶é”™è¯¯ã€‚

        - è®¾ç½®ä¸º 1 çš„æ„ä¹‰ï¼šå³ä¾¿å‡ºç°å¼‚å¸¸çš„â€œæœ€å¤§è¡€é‡ â‰¤ 0â€ï¼Œä¹Ÿèƒ½å®‰å…¨æ¸²æŸ“ä¸€ä¸ªæœ€å°å°ºåº¦çš„è¿›åº¦æ¡ã€‚

    3. `cur = max(0, min(cur, maxv))`

        - **é’³åˆ¶ï¼ˆclampï¼‰å½“å‰å€¼**åˆ°åˆæ³•èŒƒå›´ `[0, maxv]`ï¼š
            - è¿‡é‡ä¼¤å®³å¯¼è‡´çš„è´Ÿå€¼ â†’ æ‹‰å› 0ï¼›
            - åŠ æˆ/æº¢å‡ºæ²»ç–—å¯¼è‡´çš„è¶…ä¸Šé™ â†’ æ‹‰å› `maxv`ã€‚
        - è¿™æ ·å¯ä¿è¯åç»­è®¡ç®—çš„æ¯”ä¾‹å’Œç»˜åˆ¶ä¸ä¼šè¶Šç•Œã€‚

    4. `ratio = cur / maxv`

        - è®¡ç®—**å½“å‰è¡€é‡å æ¯”**ï¼ˆ0.0 ~ 1.0ï¼‰ã€‚
        - ç”±äºä¸Šä¸€æ­¥å·²é’³åˆ¶ï¼Œ`ratio` ä¸€å®šåœ¨åˆæ³•åŒºé—´å†…ã€‚

    5. `filled = int(ratio * width + 0.5)  # å››èˆäº”å…¥`

        - è®¡ç®—**åº”è¯¥å¡«å……å¤šå°‘æ ¼**ï¼ˆ`#` çš„æ•°é‡ï¼‰ã€‚
        - `ratio * width` ç»™å‡ºâ€œç†æƒ³å¡«å……æ ¼æ•°â€çš„å°æ•°å€¼ï¼›æˆ‘ä»¬å¸Œæœ›**å››èˆäº”å…¥**åˆ°æœ€è¿‘çš„æ•´æ•°ã€‚
        - ç”¨ `int(x + 0.5)` è€Œä¸æ˜¯ `round(x)` çš„åŸå› ï¼š
            - Python çš„ `round` æ˜¯**é“¶è¡Œå®¶èˆå…¥**ï¼ˆ`.5` å‘æœ€è¿‘çš„å¶æ•°é æ‹¢ï¼‰ï¼Œä¾‹å¦‚ `round(8.5) == 8`ï¼›
            - `int(x + 0.5)` æ˜¯æ›´ç›´è§‰çš„ â€œ`.5 åŠä»¥ä¸Šè¿›ä¸€`â€ï¼š
                - ä¾‹ï¼š`8.5 â†’ int(9.0) = 9`ã€‚
            - å› ä¸º `ratio * width` æ°¸ä¸ä¸ºè´Ÿï¼Œæ­¤å†™æ³•ç®€å•ç¨³å®šã€‚

    6. `bar = "#" * filled + "-" * (width - filled)`

        - æ„é€ æ¡å½¢ï¼šå·¦è¾¹ `#` è¡¨ç¤ºå½“å‰è¡€é‡ï¼Œå³è¾¹ `-` è¡¨ç¤ºæœªå¡«å……éƒ¨åˆ†ã€‚
        - å­—ç¬¦ä¸²ä¹˜æ³•å¿«é€Ÿç”Ÿæˆé‡å¤å­—ç¬¦ï¼Œ**O(width)** æ—¶é—´å¤æ‚åº¦ï¼Œè¶³å¤Ÿè½»é‡ã€‚

    7. `return f"[{bar}] {int(ratio * 100):3d}%  {cur}/{maxv}"`

        - æœ€ç»ˆæ–‡æœ¬åŒ…å«ä¸‰éƒ¨åˆ†ï¼š
            1. **æ–¹æ‹¬å·åŒ…è£¹çš„æ¡å½¢**ï¼š`[##########----------]`
            2. **ç™¾åˆ†æ¯”**ï¼š`{int(ratio * 100):3d}%`
                - è¿™é‡Œç”¨ `int()` è€Œä¸æ˜¯å››èˆäº”å…¥ï¼šæ˜¾ç¤ºä¸Šæ›´â€œä¿å®ˆâ€ï¼ˆä¾‹å¦‚ 99.6% æ˜¾ç¤º 99%ï¼‰ã€‚
                - `:3d` ä¿è¯å®½åº¦ 3 â€”â€” â€œ  5% /  50% / 100%â€å¯¹é½æ›´æ•´é½ã€‚
            3. **æ•°å€¼å½¢å¼**ï¼š`cur/maxv`ï¼ˆä¾‹ï¼š`50/100`ï¼‰ï¼Œä¾¿äºç²¾ç¡®æŸ¥çœ‹ã€‚

    #### 14.21.3 å°ä¾‹å­ï¼ˆå¿ƒç®—å³å¯ï¼‰

    ä»¥ `width = 20` ä¸ºä¾‹ï¼š

    - `cur=0, maxv=100`
        - `ratio=0`ï¼›`filled=int(0*20+0.5)=0`
        - æ¡ï¼š`[--------------------]  0%  0/100`
    - `cur=73, maxv=100`
        - `ratio=0.73`ï¼›`filled=int(0.73*20+0.5)=int(14.6+0.5)=15`
        - æ¡ï¼š`[###############-----] 73%  73/100`ï¼ˆ15 ä¸ª `#`ï¼Œ5 ä¸ª `-`ï¼‰
    - `cur=99, maxv=100`
        - `ratio=0.99`ï¼›`filled=int(19.8+0.5)=20` â†’ **æ¡ä¼šæ»¡æ ¼**
        - ç™¾åˆ†æ¯” `int(99)=99%` â†’ å¯èƒ½å‡ºç°â€œæ¡å·²æ»¡ä½†æ˜¾ç¤º 99%â€çš„**è½»å¾®ä¸ä¸€è‡´**ï¼ˆå¯æ¥å—ï¼‰
    - `cur=100, maxv=100`
        - `ratio=1.0`ï¼›`filled=int(20+0.5)=20`
        - æ¡ï¼š`[####################]100% 100/100`
    - è¶Šç•Œæƒ…å†µï¼š`cur=-5` â†’ é’³æˆ 0ï¼›`cur=120` â†’ é’³æˆ 100ã€‚

**ä¸ºä»€ä¹ˆå®ƒâ€œè·¨å¹³å°ç¨³â€** 

- **åªç”¨ ASCII**ï¼ˆ`#`ã€`-`ã€`[]`ï¼‰ï¼Œä¸ä¾èµ–é¢œè‰²ã€å®½å­—ç¬¦æˆ–ç»ˆç«¯è½¬ä¹‰åºåˆ—ï¼›
- ä¸éœ€è¦æ£€æµ‹ç»ˆç«¯æ˜¯å¦æ”¯æŒ ANSI é¢œè‰²ï¼Œ**CMD / PowerShell / macOS ç»ˆç«¯**éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼›
- æ¨ªå‘å¯¹é½é€šè¿‡å›ºå®š `width` å’Œç™¾åˆ†æ¯”å­—æ®µå®½åº¦ `:3d` è¾¾æˆã€‚

**å¯æŒ‰éœ€çš„å°æ”¹åŠ¨ï¼ˆå¯é€‰ï¼‰** 

1. **è®©ç™¾åˆ†æ¯”ä¸æ¡å½¢ä¸€è‡´åœ°â€œå››èˆäº”å…¥â€**ï¼ˆè€Œéå–æ•´ï¼‰ï¼š

    ```python
    pct = int(ratio * 100 + 0.5)
    return f"[{bar}] {pct:3d}%  {cur}/{maxv}"
    ```

    è¿™æ · 99.6% ä¼šæ˜¾ç¤ºä¸º 100%ã€‚

2. **ä¾æ®æ¡å½¢åæ¨ç™¾åˆ†æ¯”**ï¼ˆç»å¯¹ä¸€è‡´ï¼‰ï¼š

    ```python
    pct = int((filled / width) * 100 + 0.5)
    ```

    è¿™æ ·æ¡æ»¡ä¸€å®šæ˜¾ç¤º 100%ã€‚

    æ­¤å¤„è€ƒè™‘ç©å®¶æ›´ä¾èµ– 50/100 çš„è¡€é‡æ˜¾ç¤ºï¼Œå› æ­¤æ¡å½¢å’Œç™¾åˆ†æ¯”çš„ä½œç”¨ç±»ä¼¼ï¼Œä¸”é‡è¦ç¨‹åº¦ç›¸å½“ï¼Œæ‰€ä»¥å¯ä»¥ä¿æŒä¸€è‡´ã€‚

    ::: details æ¡å½¢åæ¨ç™¾åˆ†æ¯”

    ```python
    pct = int((filled / width) * 100 + 0.5)
    ```

    å…¶å®åœ¨åšä¸€ä»¶å¾ˆæœ´ç´ çš„äº‹ï¼š**å…ˆçœ‹æ¡å½¢å›¾å®é™…â€œç‚¹äº®äº†å‡ æ ¼â€ï¼ˆfilledï¼‰ï¼Œå†æŠŠå®ƒæ¢ç®—æˆç™¾åˆ†æ¯”**ï¼Œæœ€ååšä¸€ä¸ª**å››èˆäº”å…¥**ã€‚

    #### 1. ä¸€å¥è¯ç‰ˆ

    è¿›åº¦æ¡æ˜¯â€œç¦»æ•£â€çš„ï¼ˆæ¯”å¦‚ä¸€å…± 20 æ ¼ï¼Œåªèƒ½äº® 0,1,2,â€¦,20 æ ¼ï¼‰ã€‚

    æ—¢ç„¶æ¡å½¢æ˜¾ç¤ºæ˜¯æŒ‰â€œäº®äº†å‡ æ ¼â€æ¥çš„ï¼Œé‚£**ç™¾åˆ†æ¯”ä¹Ÿç”¨äº®æ ¼æ•°å»ç®—**ï¼Œä¿è¯ä¸¤è€…å®Œå…¨ä¸€è‡´ã€‚

    #### 2. ä¸ºä»€ä¹ˆè¦â€œä¾æ®æ¡å½¢åæ¨ç™¾åˆ†æ¯”â€ï¼Ÿ

    å¦‚æœç”¨**çœŸå®æ¯”ä¾‹**ç®—ç™¾åˆ†æ¯”ï¼Œæ¯”å¦‚ï¼š

    ```python
    ratio = cur / maxv
    pct = int(ratio * 100)   # æˆ– round(ratio * 100)
    ```

    è€Œæ¡å½¢æ ¼æ•°å´æ˜¯ï¼š

    ```python
    filled = int(ratio * width + 0.5)   # å››èˆäº”å…¥åˆ°æœ€è¿‘çš„æ ¼å­
    ```

    è¿™ä¸¤å¤„**ç‹¬ç«‹å››èˆäº”å…¥**ï¼Œå°±å¯èƒ½å‡ºç°ä¸ä¸€è‡´ï¼š

    - ä¾‹å­1ï¼ˆwidth=20ï¼‰ï¼š
        `cur=49, maxv=100 â†’ ratio=0.49`

        - **æ¡å½¢æ ¼æ•°**ï¼š`filled = int(0.49*20 + 0.5) = int(9.8 + 0.5) = 10`ï¼ˆäº® 10/20 æ ¼ = 50% çš„â€œè§†è§‰â€ï¼‰

        - **ç™¾åˆ†æ¯”ï¼ˆçœŸå®æ¯”ä¾‹å–æ•´ï¼‰**ï¼š`int(0.49*100) = 49%`

            â‡’ æ¡å½¢çœ‹èµ·æ¥æ˜¯ 50%ï¼Œæ•°å­—å´å†™ 49% â€”â€” è¿å’Œã€‚

    - ä¾‹å­2ï¼ˆwidth=20ï¼‰ï¼š
        `cur=99, maxv=100 â†’ ratio=0.99`

        - **æ¡å½¢æ ¼æ•°**ï¼š`filled = int(0.99*20 + 0.5) = 20`ï¼ˆæ»¡æ ¼ï¼‰

        - **ç™¾åˆ†æ¯”ï¼ˆçœŸå®æ¯”ä¾‹å–æ•´ï¼‰**ï¼š`int(99) = 99%`

            â‡’ æ»¡æ ¼ä½†å†™ 99% â€”â€” åˆè¿å’Œã€‚

    æ‰€ä»¥ï¼Œ**ç”¨æ¡å½¢â†’ç™¾åˆ†æ¯”**å°±ä¸ä¼šæœ‰è¿™ç§åˆ†è£‚ï¼š `filled/width` æ˜¯æ¡å½¢çœŸæ­£è¡¨è¾¾çš„å æ¯”ï¼Œä¹˜ä»¥ 100 å°±æ˜¯â€œæ¡å½¢æ‰€ä»£è¡¨çš„ç™¾åˆ†æ¯”â€ã€‚

    #### 3. è¿™è¡Œä»£ç é€è¯è§£é‡Š

    ```python
    pct = int((filled / width) * 100 + 0.5)
    ```

    - `filled / width`ï¼šæ¡å½¢**å®é™…**çš„å æ¯”ï¼ˆæ¯”å¦‚ 10/20 = 0.5ï¼‰ã€‚

    - `* 100`ï¼šæŠŠå æ¯”å˜æˆç™¾åˆ†æ•°ï¼ˆ0.5 â†’ 50ï¼‰ã€‚

    - `+ 0.5` å† `int(...)`ï¼šå¯¹**éè´Ÿæ•°**å®ç°â€œ**å››èˆäº”å…¥**â€ã€‚

        ï¼ˆå› ä¸º `int(x+0.5)` ç­‰ä»·äºæŠŠ x å››èˆäº”å…¥åˆ°æœ€è¿‘æ•´æ•°ã€‚ï¼‰

    > è¿™æ ·å¾—åˆ°çš„ `pct`ï¼Œ**ä¸€å®š**å’Œä½ å½“å‰æ˜¾ç¤ºçš„æ ¼æ•°å¯¹åº”çš„ç™¾åˆ†æ¯”ä¸€è‡´ã€‚
    >
    > ä¾‹å¦‚ `filled = 10, width = 20 â†’ pct = 50`ï¼›`filled = 20 â†’ pct = 100`ã€‚

    #### 4. ä½•æ—¶è¯¥ç”¨è¿™ç§å†™æ³•ï¼Ÿ

    - ä½ **å¸Œæœ›æ•°å­—å’Œè¿›åº¦æ¡å¤–è§‚â€œç»å¯¹ä¸€è‡´â€**æ—¶ï¼Œç”¨å®ƒï¼
    - è¿™ä¹Ÿæ„å‘³ç€ç™¾åˆ†æ¯”åªèƒ½æ˜¯ `0, 100/width, 2*100/width, ... 100` è¿™å‡ æ¡£ï¼ˆæ¯”å¦‚ `width=20` å°±æ˜¯æ¯ 5% ä¸€æ¡£ï¼‰â€”â€”å’Œä½ çš„æ¡å½¢â€œæ¡£ä½â€å®Œå…¨åŒæ­¥ã€‚

    #### 5. æ”¾å›å‡½æ•°é‡Œï¼ˆç¤ºä¾‹ï¼‰

    ```python
    def hp_bar(cur: int, maxv: int, width: int = 20) -> str:
        if maxv <= 0:
            maxv = 1
        cur = max(0, min(cur, maxv))
        ratio = cur / maxv
        filled = int(ratio * width + 0.5)          # å…ˆå†³å®šäº®å‡ æ ¼ï¼ˆæ¡å½¢å¤–è§‚ï¼‰
        pct = int((filled / width) * 100 + 0.5)    # å†ç”¨â€œäº®æ ¼æ¯”ä¾‹â€ç®—ç™¾åˆ†æ¯”ï¼Œç¡®ä¿ä¸€è‡´
        bar = "#" * filled + "-" * (width - filled)
        return f"[{bar}] {pct:3d}%  {cur}/{maxv}"
    ```

    è¿™æ ·ï¼Œæ— è®º `cur/maxv` æ˜¯å¤šå°‘ï¼Œå°æ•°æ€ä¹ˆæŠ–åŠ¨ï¼Œ**æ¡å½¢æ˜¾ç¤ºå’Œæ•°å­—éƒ½ä¼šè¯´åŒä¸€ä¸ªâ€œçœŸç›¸â€**ã€‚

    :::

    

3. **è°ƒæ•´åˆ†è¾¨ç‡**ï¼š

    - æé«˜ `width`ï¼ˆå¦‚ 30ã€40ï¼‰â†’ æ¡å½¢æ›´â€œç»†è…»â€ï¼›
    - é™ä½ `width`ï¼ˆå¦‚ 10ï¼‰â†’ æ›´ç´§å‡‘ã€‚

 **ä¸€å¥è¯æ€»ç»“** 

- **é’³åˆ¶**ä¿è¯èŒƒå›´åˆæ³•ï¼›
- **æ¯”ä¾‹**å†³å®šå¡«å……ï¼›
- ç”¨ `int(x+0.5)` **å››èˆäº”å…¥**é¿å…é“¶è¡Œå®¶èˆå…¥ï¼›
- **æ‹¼æ¥ ASCII** æ„æˆç¨³å®šçš„è·¨å¹³å°è¿›åº¦æ¡ï¼›
- **å¯¹é½æ ¼å¼**è®©å¤šæ¬¡æ‰“å°è¯»èµ·æ¥æ›´æ•´é½ã€‚

::: details é“¶è¡Œå®¶èˆå…¥

**é“¶è¡Œå®¶èˆå…¥**ï¼ˆBankerâ€™s Roundingï¼Œä¹Ÿå«â€œ**å››èˆå…­å…¥äº”ç•™åŒ / äº”æˆåŒ**â€ã€â€œ**round half to even**â€ï¼‰æ˜¯ä¸€ç§åœ¨**æ°å¥½è½åœ¨ä¸­ç‚¹**æ—¶ï¼ˆå°æ•°éƒ¨åˆ†æ­£å¥½æ˜¯ 0.5ï¼Œæˆ–ä¿ç•™ä½åå…¨æ˜¯ 0ï¼‰æŠŠæ•°å€¼èˆå…¥åˆ°**æœ€æ¥è¿‘çš„å¶æ•°**çš„è§„åˆ™ã€‚å®ƒå¸¸ç”¨äºé‡‘èä¸ä¼šè®¡ï¼Œç›®çš„æ˜¯åœ¨å¤§é‡æ•°æ®æ±‡æ€»æ—¶**æ¶ˆé™¤ç³»ç»Ÿæ€§åå·®**ï¼ˆé¿å…æ€»æ˜¯å‘ä¸Šæˆ–æ€»æ˜¯å‘ä¸‹ï¼‰ã€‚

#### 1. è§„åˆ™ä¸€çœ¼çœ‹æ‡‚

- å°äº 0.5 â†’ èˆï¼ˆå‘ä¸‹ï¼‰
- å¤§äº 0.5 â†’ å…¥ï¼ˆå‘ä¸Šï¼‰
- **ç­‰äº 0.5 â†’ å‘æœ€è¿‘çš„â€œå¶æ•°â€èˆå…¥**ï¼ˆå…³é”®ï¼ï¼‰

#### 2. å¿«é€Ÿä¾‹å­ï¼ˆå–æ•´ï¼‰

- `1.5 â†’ 2`ï¼ˆ2 æ˜¯å¶æ•°ï¼‰
- `2.5 â†’ 2`ï¼ˆ2 æ˜¯å¶æ•°ï¼‰
- `3.5 â†’ 4`ï¼ˆ4 æ˜¯å¶æ•°ï¼‰
- `4.5 â†’ 4`ï¼ˆ4 æ˜¯å¶æ•°ï¼‰

è´Ÿæ•°ä¹Ÿä¸€æ ·æŒ‰â€œå°±è¿‘å¶æ•°â€ï¼š

- `-1.5 â†’ -2`ï¼ˆ-2 æ˜¯å¶æ•°ï¼‰
- `-2.5 â†’ -2`ï¼ˆ-2 æ˜¯å¶æ•°ï¼‰

#### 3. ä¿ç•™åˆ°æŒ‡å®šä½ï¼ˆçœ‹ä¿ç•™ä½åä¸€ä½ï¼‰

ä»¥ä¿ç•™ä¸¤ä½å°æ•°ä¸ºä¾‹ï¼ˆçœ‹â€œç¬¬ä¸‰ä½â€ï¼‰ï¼š

- `2.345` â†’ ç¬¬ä¸‰ä½æ˜¯ 5ï¼Œ**ç¬¬äºŒä½æ˜¯ 4ï¼ˆå¶ï¼‰** â†’ `2.34`
- `2.355` â†’ ç¬¬ä¸‰ä½æ˜¯ 5ï¼Œ**ç¬¬äºŒä½æ˜¯ 5ï¼ˆå¥‡ï¼‰** â†’ `2.36`
- `12.1250` â†’ ç¬¬ä¸‰ä½æ˜¯ 5ï¼Œ**ç¬¬äºŒä½æ˜¯ 2ï¼ˆå¶ï¼‰** â†’ `12.12`

#### 4. ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ

- åœ¨å¤§è§„æ¨¡æ±‚å’Œ/ç»Ÿè®¡ä¸­ï¼Œä¼ ç»Ÿâ€œå››èˆäº”å…¥ï¼ˆ0.5 ä¸€å¾‹è¿›ä½ï¼‰â€ä¼šäº§ç”Ÿ**ç³»ç»Ÿæ€§åå¤§**ï¼›
- â€œäº”ç•™åŒï¼ˆä¸­ç‚¹å‘å¶æ•°ï¼‰â€è®©ä¸Šã€ä¸‹çš„æœºä¼šæ›´å‡è¡¡ï¼Œ**é•¿æœŸè¯¯å·®æ›´å°**ï¼Œå› æ­¤é“¶è¡Œã€ä¿é™©ã€å®¡è®¡ç­‰å¸¸ç”¨ã€‚

#### 5. åœ¨ç¼–ç¨‹è¯­è¨€é‡Œçš„è¡¨ç°

- **Python 3**ï¼š`round()` å¯¹â€œæ­£å¥½åœ¨ä¸­ç‚¹â€çš„æƒ…å†µä½¿ç”¨**é“¶è¡Œå®¶èˆå…¥**

    ```python
    round(1.5)  # 2
    round(2.5)  # 2
    round(-1.5) # -2
    ```

    æ³¨æ„æµ®ç‚¹è¡¨ç¤ºè¯¯å·®ï¼š

    ```python
    round(2.675, 2)  # 2.67ï¼ˆä¸æ˜¯ 2.68ï¼‰
    ```

    å› ä¸º 2.675 åœ¨äºŒè¿›åˆ¶æµ®ç‚¹ä¸­å¹¶ä¸ç²¾ç¡®ç­‰äº 2.675ã€‚è¦**ä¸¥æ ¼åè¿›åˆ¶èˆå…¥**å¯ç”¨ `decimal`ï¼š

    ```python
    from decimal import Decimal, ROUND_HALF_EVEN
    Decimal("2.675").quantize(Decimal("0.01"), rounding=ROUND_HALF_EVEN)  # Decimal('2.68')
    ```

- **Excel** çš„ `ROUND` é»˜è®¤æ˜¯â€œ**0.5 è¿œç¦» 0 æ–¹å‘**â€è€Œä¸æ˜¯é“¶è¡Œå®¶èˆå…¥ï¼š
    `ROUND(2.5, 0) = 3`, `ROUND(-2.5, 0) = -3`ã€‚

- **.NET**ï¼š`Math.Round(x)` é»˜è®¤ä¹Ÿæ˜¯â€œ**ToEven**â€ï¼ˆé“¶è¡Œå®¶èˆå…¥ï¼‰ã€‚

#### 6. å’Œä»£ç é‡Œçš„å…³ç³»

åœ¨è¿›åº¦æ¡é‡Œæˆ‘ç”¨äº†ï¼š

```python
filled = int(ratio * width + 0.5)  # å››èˆäº”å…¥
```

è¿™æ˜¯ä¸€ç§**â€œ0.5 ä¸€å¾‹è¿›ä½â€**çš„ç›´è§‰å››èˆäº”å…¥ï¼ˆä¸”åªé’ˆå¯¹éè´Ÿæ•°ï¼‰ã€‚ä¹‹æ‰€ä»¥ä¸ç”¨ `round()`ï¼Œæ˜¯é¿å…å‡ºç°ï¼š

```python
round(8.5) == 8   # é“¶è¡Œå®¶èˆå…¥ï¼šåˆ°å¶æ•° 8
```

å¯¹è¿›åº¦æ¡è§†è§‰ä¸ç¬¦åˆæœŸæœ›ï¼ˆä½ ä¼šå¸Œæœ› 8.5 æ›´åƒ 9 æ ¼ï¼‰ã€‚

å¦‚æœä½ **æƒ³**ç”¨é“¶è¡Œå®¶èˆå…¥æ¥ä¿è¯æ•°å­¦ä¸€è‡´æ€§ï¼Œå¯æ”¹æˆï¼š

```python
filled = round(ratio * width)  # Python 3 çš„ round æ˜¯â€œåˆ°å¶æ•°â€
```

#### 7. ä¸€å¥è¯è®°å¿†

**â€œäº”ç•™åŒâ€= ä¸­ç‚¹å°±è¿‘å¶æ•°**ã€‚å®ƒè®©å¤§é‡èˆå…¥åçš„æ€»å’Œæ›´å…¬å¹³ã€æ›´æ¥è¿‘çœŸå®å€¼ã€‚

:::





#### 9.4.10 ä½¿ç”¨ Faker åº“éšæœºç”Ÿæˆæ•Œäººå§“å

æ¯è½®æ¸¸æˆçš„æ•Œäººéƒ½åº”è¯¥æ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬å°±åšåˆ°åç§°ä¸åŒå³å¯~

Python Faker æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„åº“ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆå„ç§â€œå‡æ•°æ®â€ï¼ˆåå­—ã€åœ°å€ã€ç”µè¯ã€é‚®ç®±ã€å…¬å¸ã€é“¶è¡Œå¡å·ã€‚ã€‚ã€‚ï¼‰ï¼Œåœ¨å†™æµ‹è¯•ã€åšåŸå‹ã€æ¨¡æ‹Ÿæ•°æ®åº“æ—¶ç‰¹åˆ«æ–¹ä¾¿ã€‚

[ä¼ æ’­é—®å·è°ƒæŸ¥æ•°æ®ä¸å¤Ÿï¼Ÿè‡ªå·±ç”Ÿæˆå‡æ•°æ®ï¼](https://bornforthis.cn/blog/2022/06.html)

##### 9.4.10.1 Faker çš„åŸºç¡€ä½¿ç”¨

::: tabs

@tab 1. å®‰è£…

```python
pip install faker
```

@tab 2. åŸºæœ¬ç”¨æ³•

```python
from faker import Faker

# åˆ›å»ºä¸€ä¸ª Faker å®ä¾‹ï¼ˆé»˜è®¤æ˜¯è‹±æ–‡ç¯å¢ƒï¼‰
fake = Faker()

print(fake.name())
print(fake.address())
print(fake.email())
print(fake.text())
```

è¿è¡Œç»“æœç¤ºä¾‹ï¼š

```python
Christine Taylor
673 April Causeway
Randychester, WI 72072
ljohnson@example.org
Many toward style person daughter keep. Attorney explain use baby fine situation character.
Task task director create former walk plant collection. Hot meet past letter modern difference.
```

@tab 3. ä¸­æ–‡ç¯å¢ƒ

Faker é»˜è®¤æ˜¯è‹±æ–‡ï¼Œä½†æ˜¯æ”¯æŒå¤šè¯­è¨€ã€‚æ¯”å¦‚ç”Ÿæˆä¸­æ–‡åå­—å’Œåœ°å€ï¼š

```python
from faker import Faker

# åˆ›å»ºä¸€ä¸ª Faker å®ä¾‹ï¼ˆé»˜è®¤æ˜¯è‹±æ–‡ç¯å¢ƒï¼‰
fake = Faker('zh_CN')

print(fake.name())
print(fake.address())
print(fake.phone_number())
```

è¾“å‡ºç¤ºä¾‹ï¼š

```python
è‘›ä¸¹ä¸¹
å°æ¹¾çœæ·±åœ³å¿å…­æç‰¹éƒ‘å·è¡—Zåº§ 871973
18753320376
```

@tab 4. å¸¸ç”¨æ–¹æ³•

| æ–¹æ³•                  | è¯´æ˜      | ç¤ºä¾‹è¾“å‡º                                   |
| --------------------- | --------- | ------------------------------------------ |
| `fake.name()`         | å§“å      | ç‹ä¼Ÿ                                       |
| `fake.address()`      | åœ°å€      | ä¸Šæµ·å¸‚å¾æ±‡åŒºæ¼•æºªåŒ—è·¯...                    |
| `fake.email()`        | é‚®ç®±      | [test@qq.com](mailto:test@qq.com)          |
| `fake.phone_number()` | æ‰‹æœºå·    | 13912345678                                |
| `fake.company()`      | å…¬å¸      | è…¾è®¯ç§‘æŠ€æœ‰é™å…¬å¸                           |
| `fake.job()`          | èŒä½      | è½¯ä»¶å·¥ç¨‹å¸ˆ                                 |
| `fake.date()`         | éšæœºæ—¥æœŸ  | 2025-09-16                                 |
| `fake.ipv4()`         | IPv4 åœ°å€ | 192.168.1.10                               |
| `fake.url()`          | URL       | [https://example.com](https://example.com) |



@tab 5. æ‰¹é‡ç”Ÿæˆæ•°æ®

ç»å¸¸ç”¨åœ¨æ¨¡æ‹Ÿæ•°æ®åº“æµ‹è¯•æ•°æ®ï¼š

ä¸ªäººå®ç°ï¼š

```python
from faker import Faker

# åˆ›å»ºä¸€ä¸ª Faker å®ä¾‹ï¼ˆé»˜è®¤æ˜¯è‹±æ–‡ç¯å¢ƒï¼‰
fake = Faker('zh_CN')

i = 0
while i <= 4:
    print(fake.name(), fake.phone_number(), fake.email())
    i+=1
```

è€å¸ˆå®ç°ï¼š

```python
from faker import Faker

# åˆ›å»ºä¸€ä¸ª Faker å®ä¾‹ï¼ˆé»˜è®¤æ˜¯è‹±æ–‡ç¯å¢ƒï¼‰
fake = Faker('zh_CN')

for _ in range(5):
    print(fake.name(), fake.phone_number(), fake.email())
```



@tab 6. ç»“åˆå­—å…¸/åˆ—è¡¨ï¼Œåšâ€œå‡æ•°æ®åº“â€

```python
from faker import Faker

# åˆ›å»ºä¸€ä¸ª Faker å®ä¾‹ï¼ˆé»˜è®¤æ˜¯è‹±æ–‡ç¯å¢ƒï¼‰
fake = Faker('zh_CN')

data = [
    {
        'id': i,
        'name': fake.name(),
        'email': fake.email(),
        'address': fake.address(),
        'job': fake.job(),
        'company': fake.company(),
    }
    for i in range(1, 6)
]

for item in data:
    print(item)
```

è¾“å‡ºç¤ºä¾‹ï¼š

```python
{'id': 1, 'name': 'ç‹æ¡‚å…°', 'email': 'jie73@example.org', 'address': 'å†…è’™å¤è‡ªæ²»åŒºç§€è‹±å¸‚é•¿å¯¿éƒè·¯Låº§ 966460', 'job': 'å…¶ä»–', 'company': 'æ˜è…¾ç§‘æŠ€æœ‰é™å…¬å¸'}
{'id': 2, 'name': 'å¼ ç‰è‹±', 'email': 'yongfan@example.net', 'address': 'æ±Ÿè¥¿çœå…°å·å¿é—¨å¤´æ²Ÿæè¡—kåº§ 529875', 'job': 'ç†è´§å‘˜', 'company': 'æ©æ‚Œç½‘ç»œæœ‰é™å…¬å¸'}
{'id': 3, 'name': 'è‘£å®‡', 'email': 'csong@example.net', 'address': 'å®‰å¾½çœæµ©å¿ç‰§é‡ç‹è¡—Uåº§ 814580', 'job': 'èµ„é‡‘ç»ç†/ä¸»ç®¡', 'company': 'æ–¹æ­£ç§‘æŠ€ç½‘ç»œæœ‰é™å…¬å¸'}
{'id': 4, 'name': 'åˆ˜ç§€èŠ³', 'email': 'jiayan@example.net', 'address': 'æ¹–åŒ—çœéœå¸‚åŸåŒ—å¸­è¡—nåº§ 380078', 'job': 'å…¶ä»–', 'company': 'åæˆè‚²å“ç§‘æŠ€æœ‰é™å…¬å¸'}
{'id': 5, 'name': 'å¾ç£Š', 'email': 'daimin@example.com', 'address': 'å±±ä¸œçœé™å¸‚æ¸…åŸè¾½é˜³è·¯aåº§ 476086', 'job': 'è„šæœ¬å¼€å‘å·¥ç¨‹å¸ˆ', 'company': 'æ¯•åšè¯šä¿¡æ¯æœ‰é™å…¬å¸'}
```



:::



::: tabs

@tab 7. å›ºå®šéšæœºç§å­ï¼ˆä¿è¯å¯å¤ç°ï¼‰

æœ‰æ—¶éœ€è¦ç”Ÿæˆâ€œå›ºå®šä¸å˜â€çš„å‡æ•°æ®ï¼š

```python
from faker import Faker

Faker.seed(1234)      # å…¨å±€ç§å­ï¼Œæ•°å­—éšä¾¿è®¾ç½®
fake = Faker('zh_CN')

print(fake.name())
print(fake.name())
```

æ¯æ¬¡è¿è¡Œéƒ½ä¼šè¾“å‡ºä¸€æ ·çš„ç»“æœã€‚



@tab 8. ç”Ÿæˆåå­—å’Œé‚®ç®±é‡Œä¿æŒä¸€è‡´

éœ€è¦åå­—å’Œé‚®ç®±çš„å§“åä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚ï¼š

```python
å§“åï¼šæå¨œ  â†’ é‚®ç®±ï¼šlina@example.com
å§“åï¼šç‹åˆš  â†’ é‚®ç®±ï¼šwanggang@example.com
```

è¿™ä¸ªå°±éœ€è¦åœ¨ç”Ÿæˆé‚®ç®±æ—¶ï¼Œæ ¹æ®åå­—æ¥æ„é€ ï¼Œè€Œä¸æ˜¯è®© `fake.email()` éšæœºç”Ÿæˆã€‚

 æŠŠä¸­æ–‡åå­—è½¬æ¢æˆæ‹¼éŸ³ï¼Œå†æ‹¼æ¥é‚®ç®±

å¸¸ç”¨æ–¹æ³•æ˜¯å€ŸåŠ© `pypinyin` åº“ï¼š

```python 
pip install pinyin
```

ä»£ç å¦‚ä¸‹ï¼š

```python 
from faker import Faker
import pandas as pd
from pypinyin import lazy_pinyin

fake = Faker('zh_CN')

users = []
for i in range(1, 11):
    name = fake.name()
    # æŠŠä¸­æ–‡åå­—è½¬æˆæ‹¼éŸ³ï¼ˆlist è½¬æˆå­—ç¬¦ä¸²ï¼‰
    name_pinyin = ''.join(lazy_pinyin(name))
    email = f'{name_pinyin}@example.com'
    
    user = {
        'ID': i,
        'å§“å': name,
        'é‚®ç®±': email,
        'æ‰‹æœºå·': fake.phone_number(),
        'åœ°å€': fake.address(),
    }
    users.append(user)
    
df = pd.DataFrame(users)
df.to_csv('ç”¨æˆ·è¡¨æ•°æ®.csv', index=False, encoding='utf-8-sig')
print(df.head())
```



:::



##### 9.4.10.2 æ•Œäººå§“åéšæœºç”Ÿæˆ

åœ¨ç”Ÿæˆç©å®¶å’Œæ•Œäººæ—¶å¢åŠ  `Faker` ï¼Œ`Faker` ä¹Ÿéœ€è¦å…ˆè¿›è¡Œâ€œå®ä¾‹åŒ–â€ï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š

```python
from faker import Faker

#---snip---

player = Creature(100, "AIæ‚¦åˆ›")
enemy_fake = Faker('zh_CN')
enemy = Creature(80, enemy_fake.name())
```



ç›®å‰å®Œæ•´ä»£ç ï¼š

```python
import random
from faker import Faker


# â€”â€” ç®€å•æ— è‰²è¿›åº¦æ¡ï¼ˆçº¯ ASCIIï¼Œè·¨å¹³å°ï¼‰â€”â€”
def hp_bar(cur: int, maxv: int, width: int = 20) -> str:
    """è¿”å›å½¢å¦‚ï¼š[##########----------] 50%  5g0/100 çš„è¿›åº¦æ¡æ–‡æœ¬"""
    if maxv <= 0:
        maxv = 1
    cur = max(0, min(cur, maxv))
    ratio = cur / maxv
    filled = int(ratio * width + 0.5)  # å››èˆäº”å…¥
    bar = "#" * filled + "-" * (width - filled)
    return f"[{bar}] {int(ratio * 100):3d}%  {cur}/{maxv}"


class Creature:
    def __init__(self, hp, name):
        self.hp = int(hp)
        self.max_hp = int(hp)  # è®°å½•åˆå§‹æ»¡è¡€
        self.name = name

    def attack(self):
        return random.randint(0, 50)

    def not_dead(self):
        return self.hp > 0

    def being_attack(self, dmg: float):
        """å—åˆ°ä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´ä»¥é¿å…æµ®ç‚¹ HPï¼‰ï¼Œå¹¶ä¿è¯ HP ä¸ä¼šæ‰åˆ°è´Ÿæ•°ä»¥ä¸‹"""
        self.hp = max(0, int(self.hp - dmg))

    def heal_full(self):
        """ç›´æ¥å›åˆ°åˆå§‹æ»¡è¡€"""
        self.hp = self.max_hp

    def show_status(self):
        print(f"{self.name}'s HP â†’ {hp_bar(self.hp, self.max_hp)}")

fk = Faker(locale='zh_CN')
player = Creature(100, "AIæ‚¦åˆ›")
enemy = Creature(80, fk.name())

heal_used = False  # æ²»ç–—ä»…é™ä¸€æ¬¡
heal_penalty_active = False  # æ˜¯å¦å·²è§¦å‘â€œæ•Œäººæ”»å‡»ç¿»å€â€çš„æƒ©ç½š

while player.not_dead() and enemy.not_dead():
    player.show_status()
    enemy.show_status()

    # æ˜¯å¦å‡ºç°æ²»ç–—æç¤ºï¼šä»…å½“å½“å‰ HP < åˆå§‹ HP çš„ 50% ä¸”å°šæœªä½¿ç”¨
    can_heal_now = (not heal_used) and (player.hp < player.max_hp * 0.5)

    if can_heal_now:
        prompt = 'Attack or Defence or Heal (A/D/H)ï¼š'
        valid_inputs = {"A", "D", "H"}
        print('ï¼ˆæç¤ºï¼šä½ ç°åœ¨å¯ä»¥æŒ‰ H å›æ»¡è¡€ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰')
    else:
        prompt = 'Attack or Defence (A/D)ï¼š'
        valid_inputs = {"A", "D"}

    if heal_penalty_active:
        print('ã€è­¦å‘Šã€‘æ²»ç–—ä»£ä»·ç”Ÿæ•ˆä¸­ï¼šæ•Œäººå¯¹ä½ çš„ä¼¤å®³ Ã—2ï¼')

    user_input = input(prompt).strip().upper()
    while user_input not in valid_inputs:
        user_input = input("è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥ï¼š" + prompt).strip().upper()

    # æ•Œäººé€‰æ‹©ï¼ˆå¯¹ A/D æœ‰å½±å“ï¼›è‹¥ç©å®¶é€‰æ‹© Hï¼Œæˆ‘ä»¬è®©æ•Œäººæœ¬å›åˆç›´æ¥æ”»å‡»ï¼‰
    enemy_status = ['Attack', 'Defence']
    enemy_choice = random.choices(enemy_status, weights=[0.7, 0.3], k=1)[0]  # æ•Œäººæ›´å€¾å‘äºæ”»å‡»


    # å½“å‰æ•Œäººä¼¤å®³å€ç‡ï¼ˆæ˜¯å¦ç¿»å€ï¼‰
    def enemy_mul():
        return 2.0 if heal_penalty_active else 1.0


    if user_input == "H":
        # åªæœ‰åœ¨ can_heal_now ä¸º True æ—¶æ‰ä¼šè¿›å…¥åˆ°è¿™é‡Œ
        print("ä½ ä½¿ç”¨äº†æ²»ç–—æŠ€èƒ½ï¼è¡€é‡å·²å›æ»¡ã€‚")
        player.heal_full()
        heal_used = True

        # è§¦å‘æ²»ç–—ä»£ä»·ï¼šä»ç°åœ¨èµ·æ•Œäººæ”»å‡»ç¿»å€ï¼ˆåŒ…å«æœ¬å›åˆçš„éšåçš„æ•Œäººæ”»å‡»ï¼‰
        heal_penalty_active = True

        # æ•Œäººå›åˆï¼šç›´æ¥æ”»å‡»ï¼ˆå…ˆæ²»å†æŒ¨æ‰“ï¼‰
        raw_enemy_attack_value = enemy.attack()
        damage = raw_enemy_attack_value * enemy_mul()
        print(f"{enemy.name} æ”»å‡»äº†ä½ ï¼Œé€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
        player.being_attack(damage)

    elif user_input == "A":
        player_attack_coefficient = 1
        if enemy_choice == "Defence":
            print(f"{enemy.name} chose to defend!")
            player_attack_coefficient = 0.5
        else:
            print(f"{enemy.name} chose to attack!")
            raw_enemy_attack_value = enemy.attack()
            damage = raw_enemy_attack_value * enemy_mul()
            print(f"{enemy.name} å¯¹ä½ é€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
            player.being_attack(damage)

        player_attack_value = player.attack()
        enemy.being_attack(player_attack_value * player_attack_coefficient)

    elif user_input == "D":
        # é˜²å¾¡ï¼šæ•Œäººæ”»å‡»å‡ä¼¤ä¸º 90%ï¼Œç„¶åå†åº”ç”¨ç¿»å€å€ç‡
        raw_enemy_attack_value = enemy.attack()
        damage = raw_enemy_attack_value * 0.1 * enemy_mul()
        print(f"{enemy.name} æ”»å‡»äº†ä½ ï¼ˆè¢«ä½ é˜²ä½å¤§éƒ¨åˆ†ï¼‰ï¼Œé€ æˆ {int(damage)} ç‚¹ä¼¤å®³ï¼"
              f"ï¼ˆåŸå§‹{int(raw_enemy_attack_value)} Ã— å‡ä¼¤0.1 Ã— å€ç‡{enemy_mul():.0f}ï¼‰")
        player.being_attack(damage)

if player.not_dead():
    print("You Win!")
else:
    print("You Lose!")
```







